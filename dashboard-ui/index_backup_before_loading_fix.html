<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>EnumRust Security Dashboard v2.0 - Enhanced Cloud Storage</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #10b981;
            --primary-purple: #9333ea;
            --primary-blue: #3b82f6;
            --primary-red: #ef4444;
            --primary-yellow: #f59e0b;
            --primary-orange: #f97316;
            --dark-bg: #0f172a;
            --darker-bg: #020617;
            --card-bg: #1e293b;
            --card-hover: #334155;
            --text-white: #ffffff;
            --text-gray: #94a3b8;
            --border-color: #334155;
            --hover-bg: #475569;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #dc2626;
            --info: #0ea5e9;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
                transform: scale(1.02);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(16, 185, 129, 0.5);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--darker-bg);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
        }

        .login-box {
            background: var(--card-bg);
            padding: 50px;
            border-radius: 20px;
            border: 2px solid var(--primary-green);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(16, 185, 129, 0.2);
            width: 100%;
            max-width: 450px;
            animation: slideInUp 0.6s ease;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 60px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .login-box h1 {
            text-align: center;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-gray);
            margin-bottom: 40px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary-green);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-white);
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideInUp 0.3s ease;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            border-right: 2px solid var(--border-color);
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            animation: slideInRight 0.5s ease;
        }

        .sidebar-header {
            margin-bottom: 40px;
            text-align: center;
        }

        .sidebar-logo {
            font-size: 40px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-subtitle {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 5px;
        }

        .domain-selector {
            margin-bottom: 30px;
        }

        .domain-selector label {
            display: block;
            color: var(--text-gray);
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .domain-selector select {
            width: 100%;
            padding: 12px;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .domain-selector select:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section-title {
            color: var(--text-gray);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 15px;
            padding-left: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item i {
            margin-right: 12px;
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .nav-item:hover {
            background: var(--hover-bg);
            color: var(--text-white);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            color: white;
            font-weight: 600;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 30px;
            border-top: 2px solid var(--border-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--dark-bg);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 700;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-white);
        }

        .user-role {
            font-size: 11px;
            color: var(--text-gray);
        }

        .btn-logout {
            width: 100%;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            border-radius: 8px;
            color: var(--danger);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-logout:hover {
            background: var(--danger);
            color: white;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
            animation: slideInUp 0.5s ease;
        }

        /* Header */
        .content-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-white);
        }

        .header-badge {
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn-action {
            padding: 10px 20px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-white);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-action:hover {
            border-color: var(--primary-green);
            background: var(--hover-bg);
        }

        .btn-action i {
            font-size: 14px;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
            animation: slideInUp 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--primary-purple));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-green);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.critical {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .stat-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-icon.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .stat-icon.info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-white);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-gray);
            font-weight: 500;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            margin-top: 10px;
        }

        .stat-trend.up {
            color: var(--success);
        }

        .stat-trend.down {
            color: var(--danger);
        }

        /* Alerts Section */
        .alerts-container {
            margin-bottom: 30px;
        }

        .alert {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.5s ease;
            transition: all 0.3s;
        }

        .alert:hover {
            transform: translateX(5px);
        }

        .alert.critical {
            border-left-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        .alert.warning {
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }

        .alert.success {
            border-left-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }

        .alert.info {
            border-left-color: var(--info);
            background: rgba(59, 130, 246, 0.05);
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .alert.critical .alert-icon {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .alert.warning .alert-icon {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .alert.success .alert-icon {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .alert.info .alert-icon {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 15px;
        }

        .alert-message {
            color: var(--text-gray);
            font-size: 13px;
        }

        .alert-time {
            color: var(--text-gray);
            font-size: 12px;
        }

        /* Search and Filter Bar */
        .filter-bar {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 16px;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .filter-select {
            padding: 12px 16px;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .btn-filter {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }

        /* Data Table */
        .data-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
            animation: slideInUp 0.5s ease;
        }

        .data-card-header {
            padding: 20px 25px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-card-count {
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary-green);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 700;
        }

        .data-card-actions {
            display: flex;
            gap: 10px;
        }

        .btn-card-action {
            padding: 8px 16px;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-white);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-card-action:hover {
            border-color: var(--primary-green);
            background: var(--hover-bg);
        }

        .data-table {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--dark-bg);
        }

        th {
            padding: 15px 20px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        tbody tr:hover {
            background: var(--hover-bg);
        }

        td {
            padding: 18px 20px;
            font-size: 14px;
            color: var(--text-white);
        }

        .severity-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .severity-critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .severity-high {
            background: rgba(249, 115, 22, 0.2);
            color: var(--orange);
        }

        .severity-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .severity-low {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .severity-info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        .url-cell {
            color: var(--primary-green);
            cursor: pointer;
            transition: all 0.3s;
        }

        .url-cell:hover {
            color: var(--primary-purple);
            text-decoration: underline;
        }

        .btn-copy {
            padding: 6px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--primary-green);
            border-radius: 6px;
            color: var(--primary-green);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }

        .btn-copy:hover {
            background: var(--primary-green);
            color: white;
        }

        /* Loading States */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: var(--text-gray);
            font-size: 14px;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 60px;
            color: var(--text-gray);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            color: var(--text-gray);
            font-size: 16px;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-title h2 {
                font-size: 22px;
            }

            .filter-bar {
                flex-direction: column;
            }

            .search-input {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--hover-bg);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--card-bg);
            color: var(--text-white);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            border: 1px solid var(--border-color);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Setup Styles */
        .setup-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
        }

        .setup-box {
            background: var(--card-bg);
            padding: 50px;
            border-radius: 20px;
            border: 2px solid var(--primary-purple);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(147, 51, 234, 0.2);
            width: 100%;
            max-width: 500px;
            animation: slideInUp 0.6s ease;
        }

        .setup-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-logo i {
            font-size: 70px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .setup-box h1 {
            text-align: center;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }

        .setup-subtitle {
            text-align: center;
            color: var(--text-gray);
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.6;
        }

        .setup-code-display {
            background: var(--dark-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 25px;
        }

        .setup-code-display .code {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-purple);
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
        }

        .setup-code-display .label {
            color: var(--text-gray);
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideInUp 0.3s ease;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--primary-green);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 450px;
            animation: slideInUp 0.4s ease;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px 10px;
        }

        .modal-close:hover {
            color: var(--danger);
            transform: scale(1.1);
        }

        .btn-secondary {
            background: var(--card-hover);
            border: 2px solid var(--border-color);
            color: var(--text-white);
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
            border-color: var(--primary-green);
        }

        .password-requirements {
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-gray);
        }

        .password-requirements ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .password-requirements li {
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration - Use empty string to make it work from any host
        const API_URL = window.location.origin;

        // Main App Component
        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [token, setToken] = useState(null);
            const [username, setUsername] = useState('');
            const [setupCompleted, setSetupCompleted] = useState(null);
            const [checkingSetup, setCheckingSetup] = useState(true);

            useEffect(() => {
                checkSetupStatus();
                const savedToken = localStorage.getItem('authToken');
                const savedUsername = localStorage.getItem('username');
                if (savedToken) {
                    setToken(savedToken);
                    setUsername(savedUsername || 'Usuário');
                    setIsAuthenticated(true);
                }
            }, []);

            const checkSetupStatus = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/setup/status`);
                    if (response.ok) {
                        const data = await response.json();
                        setSetupCompleted(data.setup_completed);
                    }
                } catch (err) {
                    console.error('Error checking setup status:', err);
                    setSetupCompleted(false);
                } finally {
                    setCheckingSetup(false);
                }
            };

            const handleSetupComplete = () => {
                setSetupCompleted(true);
            };

            const handleLogin = (authToken, user) => {
                setToken(authToken);
                setUsername(user);
                setIsAuthenticated(true);
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('username', user);
            };

            const handleLogout = () => {
                setToken(null);
                setUsername('');
                setIsAuthenticated(false);
                localStorage.removeItem('authToken');
                localStorage.removeItem('username');
            };

            if (checkingSetup) {
                return (
                    <div className="login-container">
                        <div className="login-box" style={{textAlign: 'center'}}>
                            <i className="fas fa-spinner fa-spin" style={{fontSize: '48px', color: 'var(--primary-green)'}}></i>
                            <p style={{marginTop: '20px', color: 'var(--text-gray)'}}>Verificando configuração...</p>
                        </div>
                    </div>
                );
            }

            if (setupCompleted === false) {
                return <SetupPage onSetupComplete={handleSetupComplete} />;
            }

            if (!isAuthenticated) {
                return <LoginPage onLogin={handleLogin} />;
            }

            return <Dashboard token={token} username={username} onLogout={handleLogout} />;
        }

        // Setup Component (First-Time Access)
        function SetupPage({ onSetupComplete }) {
            const [setupCode, setSetupCode] = useState('');
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (password !== confirmPassword) {
                    setError('As senhas não coincidem!');
                    return;
                }

                if (password.length < 8) {
                    setError('A senha deve ter pelo menos 8 caracteres!');
                    return;
                }

                if (username.length < 3) {
                    setError('O usuário deve ter pelo menos 3 caracteres!');
                    return;
                }

                setLoading(true);

                try {
                    const response = await fetch(`${API_URL}/api/setup/initial`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ setup_code: setupCode, username, password }),
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        setSuccess(data.message);
                        setTimeout(() => {
                            onSetupComplete();
                        }, 2000);
                    } else {
                        setError(data.message || 'Erro ao realizar configuração inicial.');
                    }
                } catch (err) {
                    setError('Erro ao conectar com o servidor. Tente novamente.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="setup-container">
                    <div className="setup-box">
                        <div className="setup-logo">
                            <i className="fas fa-rocket"></i>
                        </div>
                        <h1>Primeiro Acesso</h1>
                        <div className="setup-subtitle">
                            Configure sua conta de administrador para começar a usar o EnumRust Security Dashboard
                        </div>

                        <div className="setup-code-display">
                            <div className="label">Código de Setup</div>
                            <div className="code">REMOVED_CODE</div>
                        </div>

                        {error && <div className="error-message"><i className="fas fa-exclamation-triangle"></i> {error}</div>}
                        {success && <div className="success-message"><i className="fas fa-check-circle"></i> {success}</div>}

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label><i className="fas fa-key"></i> Código de Setup</label>
                                <input
                                    type="text"
                                    value={setupCode}
                                    onChange={(e) => setSetupCode(e.target.value)}
                                    placeholder="Digite o código de setup"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-user-shield"></i> Nome de Usuário</label>
                                <input
                                    type="text"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    placeholder="Escolha um nome de usuário (mín. 3 caracteres)"
                                    required
                                    minLength="3"
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Senha</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Escolha uma senha forte (mín. 8 caracteres)"
                                    required
                                    minLength="8"
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Confirmar Senha</label>
                                <input
                                    type="password"
                                    value={confirmPassword}
                                    onChange={(e) => setConfirmPassword(e.target.value)}
                                    placeholder="Confirme sua senha"
                                    required
                                    minLength="8"
                                />
                            </div>
                            <div className="password-requirements">
                                <strong>Requisitos de Segurança:</strong>
                                <ul>
                                    <li>Usuário: mínimo 3 caracteres</li>
                                    <li>Senha: mínimo 8 caracteres</li>
                                    <li>Use uma combinação de letras, números e símbolos</li>
                                </ul>
                            </div>
                            <button type="submit" className="btn-login" disabled={loading} style={{marginTop: '25px'}}>
                                {loading ? <><i className="fas fa-spinner fa-spin"></i> Configurando...</> : <><i className="fas fa-rocket"></i> Criar Conta Admin</>}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Login Component
        function LoginPage({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    const response = await fetch(`${API_URL}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password }),
                    });

                    if (response.ok) {
                        const data = await response.json();
                        onLogin(data.token, username);
                    } else {
                        setError('Credenciais inválidas. Verifique seu usuário e senha.');
                    }
                } catch (err) {
                    setError('Erro ao conectar com o servidor. Tente novamente.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="login-box">
                        <div className="login-logo">
                            <i className="fas fa-shield-halved"></i>
                        </div>
                        <h1>EnumRust</h1>
                        <div className="login-subtitle">Security Dashboard - Enterprise Edition</div>

                        {error && <div className="error-message"><i className="fas fa-exclamation-triangle"></i> {error}</div>}

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label><i className="fas fa-user"></i> Usuário</label>
                                <input
                                    type="text"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    placeholder="Digite seu usuário"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Senha</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Digite sua senha"
                                    required
                                />
                            </div>
                            <button type="submit" className="btn-login" disabled={loading}>
                                {loading ? <><i className="fas fa-spinner fa-spin"></i> Entrando...</> : <><i className="fas fa-sign-in-alt"></i> Entrar</>}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ token, username, onLogout }) {
            const [domains, setDomains] = useState([]);
            const [selectedDomain, setSelectedDomain] = useState('all');
            const [activeTab, setActiveTab] = useState('overview');
            const [showChangePassword, setShowChangePassword] = useState(false);
            const [stats, setStats] = useState({
                totalDomains: 0,
                criticalIssues: 0,
                totalFindings: 0,
                lastScan: 'N/A'
            });

            useEffect(() => {
                fetchDomains();
            }, []);

            useEffect(() => {
                if (selectedDomain !== 'all') {
                    fetchDomainStats();
                }
            }, [selectedDomain]);

            const fetchDomains = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/scans`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        // api/scans returns an array directly, not an object with domains property
                        setDomains(Array.isArray(data) ? data : []);
                        if (Array.isArray(data) && data.length > 0) {
                            setSelectedDomain(data[0]);
                        }
                    }
                } catch (err) {
                    console.error('Error fetching domains:', err);
                }
            };

            const fetchDomainStats = async () => {
                // Aqui você pode buscar estatísticas específicas do domínio
                setStats({
                    totalDomains: domains.length,
                    criticalIssues: 0,
                    totalFindings: 0,
                    lastScan: new Date().toLocaleDateString('pt-BR')
                });
            };

            const tabs = [
                { id: 'overview', name: 'Visão Geral', icon: 'fa-chart-pie' },
                { id: 'progress', name: 'Scan em Andamento', icon: 'fa-spinner' },
                { id: 'infrastructure', name: 'Infraestrutura', icon: 'fa-network-wired' },
                { id: 'subdomains', name: 'Subdomínios', icon: 'fa-sitemap' },
                { id: 'nuclei', name: 'Vulnerabilidades', icon: 'fa-bug' },
                { id: 'vulnerabilities_detailed', name: 'Vulnerabilidades POC', icon: 'fa-shield-virus' },
                { id: 'github', name: 'GitHub Secrets', icon: 'fa-brands fa-github' },
                { id: 'hardcoded', name: 'Hardcoded Secrets', icon: 'fa-shield-alt' },
                { id: 'js_secrets', name: 'Secrets JS', icon: 'fa-key' },
                { id: 'js_endpoints', name: 'Endpoints JS', icon: 'fa-code' },
                { id: 'access_pages', name: 'Páginas Acessadas', icon: 'fa-file' },
                { id: 's3_buckets', name: 'S3 Buckets', icon: 'fa-bucket' },
                { id: 'http200', name: 'HTTP 200', icon: 'fa-check-circle' },
                { id: 'http403', name: 'HTTP 403', icon: 'fa-ban' },
                { id: 'settings', name: 'Configurações', icon: 'fa-cog' },
            ];

            return (
                <div className="dashboard-container">
                    <Sidebar
                        domains={domains}
                        selectedDomain={selectedDomain}
                        setSelectedDomain={setSelectedDomain}
                        tabs={tabs}
                        activeTab={activeTab}
                        setActiveTab={setActiveTab}
                        username={username}
                        onLogout={onLogout}
                        onChangePassword={() => setShowChangePassword(true)}
                    />
                    <MainContent
                        token={token}
                        domain={selectedDomain}
                        activeTab={activeTab}
                        setActiveTab={setActiveTab}
                        stats={stats}
                    />
                    {showChangePassword && (
                        <ChangePasswordModal
                            token={token}
                            onClose={() => setShowChangePassword(false)}
                        />
                    )}
                </div>
            );
        }

        // Change Password Modal Component
        function ChangePasswordModal({ token, onClose }) {
            const [currentPassword, setCurrentPassword] = useState('');
            const [newPassword, setNewPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (newPassword !== confirmPassword) {
                    setError('As senhas não coincidem!');
                    return;
                }

                if (newPassword.length < 8) {
                    setError('A nova senha deve ter pelo menos 8 caracteres!');
                    return;
                }

                setLoading(true);

                try {
                    const response = await fetch(`${API_URL}/api/auth/change-password`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            current_password: currentPassword,
                            new_password: newPassword
                        }),
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        setSuccess(data.message);
                        setTimeout(() => {
                            onClose();
                        }, 2000);
                    } else {
                        setError(data.message || 'Erro ao trocar senha.');
                    }
                } catch (err) {
                    setError('Erro ao conectar com o servidor. Tente novamente.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title"><i className="fas fa-key"></i> Trocar Senha</h2>
                            <button className="modal-close" onClick={onClose}>
                                <i className="fas fa-times"></i>
                            </button>
                        </div>

                        {error && <div className="error-message"><i className="fas fa-exclamation-triangle"></i> {error}</div>}
                        {success && <div className="success-message"><i className="fas fa-check-circle"></i> {success}</div>}

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Senha Atual</label>
                                <input
                                    type="password"
                                    value={currentPassword}
                                    onChange={(e) => setCurrentPassword(e.target.value)}
                                    placeholder="Digite sua senha atual"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Nova Senha</label>
                                <input
                                    type="password"
                                    value={newPassword}
                                    onChange={(e) => setNewPassword(e.target.value)}
                                    placeholder="Digite sua nova senha (mín. 8 caracteres)"
                                    required
                                    minLength="8"
                                />
                            </div>
                            <div className="form-group">
                                <label><i className="fas fa-lock"></i> Confirmar Nova Senha</label>
                                <input
                                    type="password"
                                    value={confirmPassword}
                                    onChange={(e) => setConfirmPassword(e.target.value)}
                                    placeholder="Confirme sua nova senha"
                                    required
                                    minLength="8"
                                />
                            </div>
                            <div className="password-requirements">
                                <strong>Requisitos:</strong>
                                <ul>
                                    <li>Senha: mínimo 8 caracteres</li>
                                    <li>Use uma combinação de letras, números e símbolos</li>
                                </ul>
                            </div>
                            <div style={{display: 'flex', gap: '10px', marginTop: '25px'}}>
                                <button type="submit" className="btn-login" disabled={loading} style={{flex: 1}}>
                                    {loading ? <><i className="fas fa-spinner fa-spin"></i> Atualizando...</> : <><i className="fas fa-check"></i> Atualizar Senha</>}
                                </button>
                                <button type="button" className="btn-secondary" onClick={onClose}>
                                    <i className="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ domains, selectedDomain, setSelectedDomain, tabs, activeTab, setActiveTab, username, onLogout, onChangePassword }) {
            return (
                <div className="sidebar">
                    <div className="sidebar-header">
                        <div className="sidebar-logo">
                            <i className="fas fa-shield-halved"></i>
                        </div>
                        <div className="sidebar-title">EnumRust</div>
                        <div className="sidebar-subtitle">Enterprise Security Platform</div>
                    </div>

                    <div className="domain-selector">
                        <label><i className="fas fa-globe"></i> Domínio Alvo</label>
                        <select value={selectedDomain} onChange={(e) => setSelectedDomain(e.target.value)}>
                            {domains.map((domain) => (
                                <option key={domain} value={domain}>{domain}</option>
                            ))}
                        </select>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Navegação</div>
                        {tabs.map((tab) => (
                            <div
                                key={tab.id}
                                className={`nav-item ${activeTab === tab.id ? 'active' : ''}`}
                                onClick={() => setActiveTab(tab.id)}
                            >
                                <i className={`fas ${tab.icon}`}></i>
                                {tab.name}
                            </div>
                        ))}
                    </div>

                    <div className="sidebar-footer">
                        <div className="user-info">
                            <div className="user-avatar">
                                {username.charAt(0).toUpperCase()}
                            </div>
                            <div className="user-details">
                                <div className="user-name">{username}</div>
                                <div className="user-role">Security Analyst</div>
                            </div>
                        </div>
                        <button className="btn-secondary" onClick={onChangePassword} style={{width: '100%', marginBottom: '10px'}}>
                            <i className="fas fa-key"></i> Trocar Senha
                        </button>
                        <button className="btn-logout" onClick={onLogout}>
                            <i className="fas fa-sign-out-alt"></i> Sair
                        </button>
                    </div>
                </div>
            );
        }

        // Main Content Component
        function MainContent({ token, domain, activeTab, setActiveTab, stats }) {
            const renderTabContent = () => {
                switch (activeTab) {
                    case 'overview':
                        return <OverviewTab token={token} domain={domain} stats={stats} setActiveTab={setActiveTab} />;
                    case 'progress':
                        return <ProgressTab token={token} domain={domain} />;
                    case 'infrastructure':
                        return <InfrastructureTab token={token} />;
                    case 'subdomains':
                        return <SubdomainsTab token={token} domain={domain} />;
                    case 'nuclei':
                        return <NucleiTab token={token} domain={domain} />;
                    case 'vulnerabilities_detailed':
                        return <VulnerabilitiesDetailedTab token={token} domain={domain} />;
                    case 'github':
                        return <GitHubTab token={token} />;
                    case 'hardcoded':
                        return <HardcodedSecretsTab token={token} domain={domain} />;
                    case 'js_secrets':
                        return <JsSecretsTab token={token} domain={domain} />;
                    case 'js_endpoints':
                        return <JsEndpointsTab token={token} domain={domain} />;
                    case 'access_pages':
                        return <AccessPagesTab token={token} domain={domain} />;
                    case 's3_buckets':
                        return <S3BucketsTab token={token} domain={domain} />;
                    case 'http200':
                        return <Http200Tab token={token} domain={domain} />;
                    case 'http403':
                        return <Http403Tab token={token} domain={domain} />;
                    case 'settings':
                        return <SettingsTab token={token} />;
                    default:
                        return <OverviewTab token={token} domain={domain} stats={stats} setActiveTab={setActiveTab} />;
                }
            };

            return (
                <div className="main-content">
                    {renderTabContent()}
                </div>
            );
        }

        // Overview Tab
        function OverviewTab({ token, domain, stats, setActiveTab }) {
            const [realData, setRealData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [subdomainsCount, setSubdomainsCount] = useState(0);
            const [secretsCount, setSecretsCount] = useState(0);
            const [s3Count, setS3Count] = useState(0);

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchRealData();
                }
            }, [domain]);

            const fetchRealData = async () => {
                setLoading(true);
                try {
                    // Buscar dados gerais do domínio
                    const dataResponse = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/data`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });

                    if (dataResponse.ok) {
                        const data = await dataResponse.json();
                        setRealData(data);
                    }

                    // Buscar subdomínios (usando endpoint estruturado para consistência)
                    const subResponse = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/subdomains`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (subResponse.ok) {
                        const subdomains = await subResponse.json();
                        setSubdomainsCount(subdomains.length);
                    }

                    // Buscar secrets
                    const secretsResponse = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/js_secrets`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (secretsResponse.ok) {
                        const secrets = await secretsResponse.json();
                        setSecretsCount(secrets.length);
                    }

                    // Buscar S3 buckets
                    const s3Response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/s3_buckets`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (s3Response.ok) {
                        const s3 = await s3Response.json();
                        setS3Count(s3.length);
                    }

                } catch (err) {
                    console.error('Error fetching overview data:', err);
                } finally {
                    setLoading(false);
                }
            };

            // Gerar alertas baseados nos dados reais
            const alerts = [];
            if (realData) {
                if (realData.critical_vulns > 0) {
                    alerts.push({
                        id: 1,
                        type: 'critical',
                        icon: 'fa-exclamation-triangle',
                        title: 'Vulnerabilidades Críticas Detectadas',
                        message: `${realData.critical_vulns} vulnerabilidades de severidade crítica encontradas`,
                        time: 'Agora'
                    });
                }
                if (realData.high_vulns > 0) {
                    alerts.push({
                        id: 2,
                        type: 'warning',
                        icon: 'fa-shield-alt',
                        title: 'Vulnerabilidades Altas',
                        message: `${realData.high_vulns} vulnerabilidades de severidade alta detectadas`,
                        time: 'Agora'
                    });
                }
                if (secretsCount > 0) {
                    alerts.push({
                        id: 3,
                        type: 'warning',
                        icon: 'fa-key',
                        title: 'Secrets Expostos Encontrados',
                        message: `${secretsCount} secrets detectados em arquivos JavaScript`,
                        time: 'Agora'
                    });
                }
                if (s3Count > 0) {
                    alerts.push({
                        id: 4,
                        type: 'info',
                        icon: 'fa-cloud',
                        title: 'S3 Buckets Identificados',
                        message: `${s3Count} buckets S3 descobertos durante a varredura`,
                        time: 'Agora'
                    });
                }
            }

            if (loading) {
                return (
                    <div className="loading-container">
                        <div className="loading-spinner"></div>
                        <div className="loading-text">Carregando dados...</div>
                    </div>
                );
            }

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-chart-pie"></i> Visão Geral - {domain}</h2>
                            <span className="header-badge">Live</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchRealData}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{subdomainsCount}</div>
                                    <div className="stat-label">Subdomínios Encontrados</div>
                                </div>
                                <div className="stat-icon info">
                                    <i className="fas fa-sitemap"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-check-circle"></i> Dados reais
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{realData?.critical_vulns || 0}</div>
                                    <div className="stat-label">Vulnerabilidades Críticas</div>
                                </div>
                                <div className="stat-icon critical">
                                    <i className="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-chart-line"></i> Total: {realData?.total_vulnerabilities || 0}
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{secretsCount}</div>
                                    <div className="stat-label">Secrets Expostos</div>
                                </div>
                                <div className="stat-icon warning">
                                    <i className="fas fa-key"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-shield-alt"></i> Dados reais
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{s3Count}</div>
                                    <div className="stat-label">S3 Buckets</div>
                                </div>
                                <div className="stat-icon success">
                                    <i className="fas fa-cloud"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-database"></i> Cloud Storage
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{realData?.total_ports || 0}</div>
                                    <div className="stat-label">Portas Abertas</div>
                                </div>
                                <div className="stat-icon info">
                                    <i className="fas fa-network-wired"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-server"></i> Infraestrutura
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-value">{realData?.high_vulns || 0}</div>
                                    <div className="stat-label">Vulnerabilidades Altas</div>
                                </div>
                                <div className="stat-icon warning">
                                    <i className="fas fa-exclamation-circle"></i>
                                </div>
                            </div>
                            <div className="stat-trend">
                                <i className="fas fa-bug"></i> Severity: High
                            </div>
                        </div>
                    </div>

                    {alerts.length > 0 && (
                        <div className="alerts-container">
                            <h3 style={{marginBottom: '20px', fontSize: '20px', fontWeight: '700'}}>
                                <i className="fas fa-bell"></i> Alertas Importantes ({alerts.length})
                            </h3>
                            {alerts.map((alert) => (
                                <div
                                    key={alert.id}
                                    className={`alert ${alert.type}`}
                                    onClick={() => setActiveTab('vulnerabilities_detailed')}
                                    style={{cursor: 'pointer', transition: 'transform 0.2s'}}
                                    onMouseEnter={(e) => e.currentTarget.style.transform = 'scale(1.02)'}
                                    onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}
                                >
                                    <div className="alert-icon">
                                        <i className={`fas ${alert.icon}`}></i>
                                    </div>
                                    <div className="alert-content">
                                        <div className="alert-title"><i className="fas fa-hand-pointer"></i> {alert.title} - Clique para Ver POC</div>
                                        <div className="alert-message">{alert.message}</div>
                                        <div style={{marginTop: '8px', fontSize: '13px', color: '#666', fontStyle: 'italic'}}>
                                            <i className="fas fa-hand-pointer"></i> Clique para ver detalhes
                                        </div>
                                    </div>
                                    <div className="alert-time">{alert.time}</div>
                                </div>
                            ))}
                        </div>
                    )}

                    {alerts.length === 0 && (
                        <div className="data-card">
                            <div className="empty-state">
                                <div className="empty-icon"><i className="fas fa-check-circle"></i></div>
                                <div className="empty-text">Nenhum alerta crítico no momento</div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        // Progress Tab - Mostra progresso do scan em tempo real
        function ProgressTab({ token, domain }) {
            const [progress, setProgress] = useState(null);
            const [loading, setLoading] = useState(true);
            const [autoRefresh, setAutoRefresh] = useState(true);

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchProgress();
                }
            }, [domain]);

            // Auto-refresh a cada 2 segundos
            useEffect(() => {
                if (!autoRefresh || !domain || domain === 'all') return;

                const interval = setInterval(() => {
                    fetchProgress();
                }, 2000);

                return () => clearInterval(interval);
            }, [autoRefresh, domain]);

            const fetchProgress = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/scan/${encodeURIComponent(domain)}/status`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setProgress(data);
                        setLoading(false);
                    }
                } catch (err) {
                    console.error('Error:', err);
                    setLoading(false);
                }
            };

            const getProgressColor = (progress) => {
                if (progress < 25) return '#ef4444';
                if (progress < 50) return '#f97316';
                if (progress < 75) return '#eab308';
                return '#22c55e';
            };

            if (loading) {
                return (
                    <div className="loading-container">
                        <div className="loading-spinner"></div>
                        <div className="loading-text">Carregando progresso...</div>
                    </div>
                );
            }

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-spinner fa-pulse"></i> Progresso do Scan</h2>
                            <span className="header-badge">{progress?.progress?.toFixed(1) || 0}%</span>
                        </div>
                        <div className="header-actions">
                            <button
                                className={`btn-action ${autoRefresh ? 'active' : ''}`}
                                onClick={() => setAutoRefresh(!autoRefresh)}
                                style={{ borderColor: autoRefresh ? 'var(--primary-green)' : '' }}
                            >
                                <i className={`fas fa-sync-alt ${autoRefresh ? 'fa-spin' : ''}`}></i>
                                {autoRefresh ? 'Auto-Refresh ON' : 'Auto-Refresh OFF'}
                            </button>
                            <button className="btn-action" onClick={fetchProgress}>
                                <i className="fas fa-redo"></i> Atualizar Agora
                            </button>
                        </div>
                    </div>

                    {/* Barra de Progresso Principal */}
                    <div className="data-card" style={{ marginBottom: '20px' }}>
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-chart-line"></i> Progresso Geral
                                <span className="data-card-count">{progress?.target || domain}</span>
                            </div>
                        </div>
                        <div style={{ padding: '30px' }}>
                            <div style={{ marginBottom: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <div style={{ fontSize: '14px', color: 'var(--text-gray)' }}>
                                    <i className="fas fa-clock"></i> Última atualização: {progress?.last_update ? new Date(progress.last_update).toLocaleTimeString('pt-BR') : 'N/A'}
                                </div>
                                <div style={{ fontSize: '24px', fontWeight: '700', color: getProgressColor(progress?.progress || 0) }}>
                                    {progress?.progress?.toFixed(1) || 0}%
                                </div>
                            </div>

                            {/* Barra de Progresso */}
                            <div style={{
                                width: '100%',
                                height: '30px',
                                backgroundColor: 'var(--dark-bg)',
                                borderRadius: '15px',
                                overflow: 'hidden',
                                position: 'relative',
                                border: '2px solid var(--border-color)'
                            }}>
                                <div style={{
                                    width: `${progress?.progress || 0}%`,
                                    height: '100%',
                                    background: `linear-gradient(90deg, ${getProgressColor(progress?.progress || 0)}, ${getProgressColor((progress?.progress || 0) + 10)})`,
                                    transition: 'width 0.5s ease',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    color: 'white',
                                    fontWeight: '700',
                                    fontSize: '12px'
                                }}>
                                    {progress?.progress > 5 && `${progress?.progress?.toFixed(0)}%`}
                                </div>
                            </div>

                            {/* Mensagem Atual */}
                            <div style={{
                                marginTop: '20px',
                                padding: '15px',
                                backgroundColor: 'var(--dark-bg)',
                                borderRadius: '8px',
                                borderLeft: '4px solid var(--primary-green)'
                            }}>
                                <div style={{ fontSize: '12px', color: 'var(--text-gray)', marginBottom: '5px', textTransform: 'uppercase', letterSpacing: '1px' }}>
                                    Status Atual
                                </div>
                                <div style={{ fontSize: '16px', fontWeight: '500' }}>
                                    {progress?.current_message || 'Aguardando início do scan...'}
                                </div>
                            </div>

                            {/* Estatísticas Rápidas */}
                            {progress?.total_events > 0 && (
                                <div style={{ marginTop: '20px', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px' }}>
                                    <div style={{
                                        padding: '15px',
                                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(34, 197, 94, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '12px', color: 'var(--success)', marginBottom: '5px' }}>
                                            <i className="fas fa-list-check"></i> Total de Eventos
                                        </div>
                                        <div style={{ fontSize: '24px', fontWeight: '700', color: 'var(--success)' }}>
                                            {progress.total_events}
                                        </div>
                                    </div>

                                    <div style={{
                                        padding: '15px',
                                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(59, 130, 246, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '12px', color: 'var(--info)', marginBottom: '5px' }}>
                                            <i className="fas fa-server"></i> Scan ID
                                        </div>
                                        <div style={{ fontSize: '14px', fontWeight: '600', color: 'var(--info)', fontFamily: 'monospace' }}>
                                            {progress.scan_id?.substring(0, 8)}...
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Histórico de Eventos */}
                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-history"></i> Histórico de Eventos
                                <span className="data-card-count">Tempo Real</span>
                            </div>
                        </div>
                        <div style={{ padding: '20px', maxHeight: '600px', overflowY: 'auto' }}>
                            {progress && progress.current_message ? (
                                <div className="alert info" style={{ marginBottom: '15px' }}>
                                    <div className="alert-icon">
                                        <i className="fas fa-info-circle"></i>
                                    </div>
                                    <div className="alert-content">
                                        <div className="alert-title">Status Atual</div>
                                        <div className="alert-message">{progress.current_message}</div>
                                    </div>
                                    <div className="alert-time">{new Date(progress.last_update).toLocaleTimeString('pt-BR')}</div>
                                </div>
                            ) : (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-hourglass-start"></i></div>
                                    <div className="empty-text">Aguardando eventos do scan...</div>
                                    <div style={{ marginTop: '10px', fontSize: '14px', color: 'var(--text-gray)' }}>
                                        Os eventos aparecerão aqui conforme o scan progride
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // Infrastructure Tab
        function InfrastructureTab({ token }) {
            const [scans, setScans] = useState([]);
            const [ports, setPorts] = useState([]);
            const [services, setServices] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeView, setActiveView] = useState('scans'); // 'scans', 'ports', 'services'
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                fetchInfrastructureData();
            }, []);

            const fetchInfrastructureData = async () => {
                setLoading(true);
                try {
                    console.log('[Infrastructure] Fetching data from API...');

                    // Fetch all infrastructure data in parallel
                    const [scansRes, portsRes, servicesRes] = await Promise.all([
                        fetch(`${API_URL}/api/infrastructure/scans`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        }),
                        fetch(`${API_URL}/api/infrastructure/ports`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        }),
                        fetch(`${API_URL}/api/infrastructure/services`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        })
                    ]);

                    console.log('[Infrastructure] API responses:', {
                        scans: scansRes.status,
                        ports: portsRes.status,
                        services: servicesRes.status
                    });

                    if (scansRes.ok) {
                        const scansData = await scansRes.json();
                        console.log('[Infrastructure] Scans loaded:', scansData.length, 'scans');
                        setScans(scansData);
                    } else {
                        console.error('[Infrastructure] Scans fetch failed:', scansRes.status);
                    }

                    if (portsRes.ok) {
                        const portsData = await portsRes.json();
                        console.log('[Infrastructure] Ports loaded:', portsData.length, 'ports');
                        setPorts(portsData);
                    } else {
                        console.error('[Infrastructure] Ports fetch failed:', portsRes.status);
                    }

                    if (servicesRes.ok) {
                        const servicesData = await servicesRes.json();
                        console.log('[Infrastructure] Services loaded:', servicesData.length, 'services');
                        setServices(servicesData);
                    } else {
                        console.error('[Infrastructure] Services fetch failed:', servicesRes.status);
                    }
                } catch (err) {
                    console.error('[Infrastructure] Error fetching data:', err);
                } finally {
                    setLoading(false);
                }
            };

            // Calculate statistics
            const stats = {
                totalScans: scans.length,
                totalHosts: scans.reduce((sum, scan) => sum + scan.hosts_up, 0),
                totalPorts: ports.length,
                totalServices: services.length
            };

            // Filter data based on search term
            const filteredScans = scans.filter(scan =>
                scan.target_range.toLowerCase().includes(searchTerm.toLowerCase()) ||
                scan.scan_id.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const filteredPorts = ports.filter(port =>
                searchTerm === '' ||
                port.port.toString().includes(searchTerm) ||
                (port.service && port.service.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            const filteredServices = services.filter(service =>
                searchTerm === '' ||
                service.service_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                service.port.toString().includes(searchTerm)
            );

            const formatDate = (dateStr) => {
                try {
                    return new Date(dateStr).toLocaleString('pt-BR');
                } catch {
                    return dateStr;
                }
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-network-wired"></i> Infraestrutura</h2>
                            <span className="header-badge">{stats.totalHosts} hosts descobertos</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-refresh" onClick={fetchInfrastructureData}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                    </div>

                    {/* Statistics Cards */}
                    <div className="stats-grid" style={{ marginBottom: '25px' }}>
                        <div className="stat-card" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
                            <div className="stat-icon"><i className="fas fa-tasks"></i></div>
                            <div className="stat-value">{stats.totalScans}</div>
                            <div className="stat-label">Total de Scans</div>
                        </div>
                        <div className="stat-card" style={{ background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' }}>
                            <div className="stat-icon"><i className="fas fa-server"></i></div>
                            <div className="stat-value">{stats.totalHosts}</div>
                            <div className="stat-label">Hosts Ativos</div>
                        </div>
                        <div className="stat-card" style={{ background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' }}>
                            <div className="stat-icon"><i className="fas fa-ethernet"></i></div>
                            <div className="stat-value">{stats.totalPorts}</div>
                            <div className="stat-label">Portas Abertas</div>
                        </div>
                        <div className="stat-card" style={{ background: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)' }}>
                            <div className="stat-icon"><i className="fas fa-cogs"></i></div>
                            <div className="stat-value">{stats.totalServices}</div>
                            <div className="stat-label">Serviços Identificados</div>
                        </div>
                    </div>

                    {/* View Selector */}
                    <div style={{
                        display: 'flex',
                        gap: '10px',
                        marginBottom: '20px',
                        borderBottom: '2px solid var(--border-color)',
                        padding: '10px 0'
                    }}>
                        <button
                            onClick={() => setActiveView('scans')}
                            style={{
                                padding: '10px 20px',
                                background: activeView === 'scans' ? 'var(--primary-purple)' : 'transparent',
                                border: 'none',
                                borderRadius: '8px',
                                color: 'white',
                                cursor: 'pointer',
                                fontWeight: '600',
                                transition: 'all 0.3s'
                            }}
                        >
                            <i className="fas fa-list"></i> Scans ({scans.length})
                        </button>
                        <button
                            onClick={() => setActiveView('ports')}
                            style={{
                                padding: '10px 20px',
                                background: activeView === 'ports' ? 'var(--primary-blue)' : 'transparent',
                                border: 'none',
                                borderRadius: '8px',
                                color: 'white',
                                cursor: 'pointer',
                                fontWeight: '600',
                                transition: 'all 0.3s'
                            }}
                        >
                            <i className="fas fa-ethernet"></i> Portas ({ports.length})
                        </button>
                        <button
                            onClick={() => setActiveView('services')}
                            style={{
                                padding: '10px 20px',
                                background: activeView === 'services' ? 'var(--primary-green)' : 'transparent',
                                border: 'none',
                                borderRadius: '8px',
                                color: 'white',
                                cursor: 'pointer',
                                fontWeight: '600',
                                transition: 'all 0.3s'
                            }}
                        >
                            <i className="fas fa-cogs"></i> Serviços ({services.length})
                        </button>
                    </div>

                    {/* Search Bar */}
                    <div className="search-bar" style={{ marginBottom: '20px' }}>
                        <i className="fas fa-search"></i>
                        <input
                            type="text"
                            placeholder={`Buscar ${activeView === 'scans' ? 'scans' : activeView === 'ports' ? 'portas' : 'serviços'}...`}
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    {loading ? (
                        <div className="loading-state">
                            <div className="loading-spinner"></div>
                            <div className="loading-text">Carregando dados de infraestrutura...</div>
                        </div>
                    ) : (
                        <>
                            {/* Scans View */}
                            {activeView === 'scans' && (
                                <div className="data-table-container">
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                <th>Scan ID</th>
                                                <th>Alvo (Range)</th>
                                                <th>Hosts Escaneados</th>
                                                <th>Hosts Ativos</th>
                                                <th>Portas Encontradas</th>
                                                <th>Vulnerabilidades</th>
                                                <th>Data/Hora</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filteredScans.length > 0 ? (
                                                filteredScans.map((scan, idx) => (
                                                    <tr key={idx}>
                                                        <td>
                                                            <span style={{
                                                                fontFamily: 'monospace',
                                                                fontSize: '11px',
                                                                background: 'var(--dark-bg)',
                                                                padding: '4px 8px',
                                                                borderRadius: '4px'
                                                            }}>
                                                                {scan.scan_id.substring(0, 8)}...
                                                            </span>
                                                        </td>
                                                        <td style={{ color: 'var(--primary-blue)' }}>
                                                            {scan.target_range}
                                                        </td>
                                                        <td>{scan.total_hosts_scanned}</td>
                                                        <td>
                                                            <span className="badge-success">
                                                                {scan.hosts_up}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span className="badge-info">
                                                                {scan.total_ports_found}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span className={scan.total_vulnerabilities_found > 0 ? 'badge-danger' : 'badge-success'}>
                                                                {scan.total_vulnerabilities_found}
                                                            </span>
                                                        </td>
                                                        <td style={{ fontSize: '12px', color: 'var(--text-gray)' }}>
                                                            {formatDate(scan.start_time)}
                                                        </td>
                                                    </tr>
                                                ))
                                            ) : (
                                                <tr>
                                                    <td colSpan="7" style={{ textAlign: 'center', padding: '40px' }}>
                                                        <div className="empty-state">
                                                            <i className="fas fa-network-wired" style={{ fontSize: '48px', opacity: '0.3' }}></i>
                                                            <div>Nenhum scan de infraestrutura encontrado</div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            )}

                            {/* Ports View */}
                            {activeView === 'ports' && (
                                <div className="data-table-container">
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                <th>Porta</th>
                                                <th>Protocolo</th>
                                                <th>Estado</th>
                                                <th>Serviço</th>
                                                <th>Versão</th>
                                                <th>Banner</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filteredPorts.length > 0 ? (
                                                filteredPorts.slice(0, 100).map((port, idx) => (
                                                    <tr key={idx}>
                                                        <td>
                                                            <span className="badge-info" style={{ fontSize: '14px', fontWeight: '700' }}>
                                                                {port.port}
                                                            </span>
                                                        </td>
                                                        <td>{port.protocol}</td>
                                                        <td>
                                                            <span className={port.state === 'open' ? 'badge-success' : 'badge-danger'}>
                                                                {port.state}
                                                            </span>
                                                        </td>
                                                        <td style={{ color: 'var(--primary-green)' }}>
                                                            {port.service || 'unknown'}
                                                        </td>
                                                        <td style={{ fontSize: '12px', color: 'var(--text-gray)' }}>
                                                            {port.version || '-'}
                                                        </td>
                                                        <td style={{
                                                            maxWidth: '300px',
                                                            overflow: 'hidden',
                                                            textOverflow: 'ellipsis',
                                                            whiteSpace: 'nowrap',
                                                            fontSize: '11px',
                                                            fontFamily: 'monospace'
                                                        }}>
                                                            {port.banner || '-'}
                                                        </td>
                                                    </tr>
                                                ))
                                            ) : (
                                                <tr>
                                                    <td colSpan="6" style={{ textAlign: 'center', padding: '40px' }}>
                                                        <div className="empty-state">
                                                            <i className="fas fa-ethernet" style={{ fontSize: '48px', opacity: '0.3' }}></i>
                                                            <div>Nenhuma porta aberta encontrada</div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                    {filteredPorts.length > 100 && (
                                        <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-gray)' }}>
                                            Mostrando 100 de {filteredPorts.length} portas. Use a busca para refinar.
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Services View */}
                            {activeView === 'services' && (
                                <div className="data-table-container">
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                <th>Serviço</th>
                                                <th>Porta Padrão</th>
                                                <th>Total de Hosts</th>
                                                <th>Hosts (IPs)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filteredServices.length > 0 ? (
                                                filteredServices.map((service, idx) => (
                                                    <tr key={idx}>
                                                        <td>
                                                            <span style={{
                                                                color: 'var(--primary-purple)',
                                                                fontWeight: '700',
                                                                fontSize: '14px'
                                                            }}>
                                                                <i className="fas fa-cog"></i> {service.service_name}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span className="badge-info">
                                                                {service.port}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span className="badge-success">
                                                                {service.count}
                                                            </span>
                                                        </td>
                                                        <td style={{
                                                            maxWidth: '400px',
                                                            overflow: 'hidden',
                                                            textOverflow: 'ellipsis',
                                                            whiteSpace: 'nowrap',
                                                            fontSize: '12px',
                                                            fontFamily: 'monospace',
                                                            color: 'var(--primary-blue)'
                                                        }}>
                                                            {service.hosts.join(', ')}
                                                        </td>
                                                    </tr>
                                                ))
                                            ) : (
                                                <tr>
                                                    <td colSpan="4" style={{ textAlign: 'center', padding: '40px' }}>
                                                        <div className="empty-state">
                                                            <i className="fas fa-cogs" style={{ fontSize: '48px', opacity: '0.3' }}></i>
                                                            <div>Nenhum serviço identificado</div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </>
                    )}
                </>
            );
        }

        // Subdomains Tab
        function SubdomainsTab({ token, domain }) {
            const [subdomains, setSubdomains] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchSubdomains();
                }
            }, [domain]);

            const fetchSubdomains = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/subdomains`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setSubdomains(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredSubdomains = subdomains.filter(sub =>
                sub.subdomain.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text);
                alert('Copiado para a área de transferência!');
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-sitemap"></i> Subdomínios</h2>
                            <span className="header-badge">{filteredSubdomains.length} encontrados</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchSubdomains}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-download"></i> Exportar CSV
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar subdomínio..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select className="filter-select">
                            <option>Todos os Status</option>
                            <option>Ativos</option>
                            <option>Inativos</option>
                        </select>
                        <button className="btn-filter">
                            <i className="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-list"></i> Lista de Subdomínios
                                <span className="data-card-count">{filteredSubdomains.length}</span>
                            </div>
                            <div className="data-card-actions">
                                <button className="btn-card-action">
                                    <i className="fas fa-sort"></i> Ordenar
                                </button>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Carregando dados...</div>
                                </div>
                            ) : filteredSubdomains.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-inbox"></i></div>
                                    <div className="empty-text">Nenhum subdomínio encontrado</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-globe"></i> Subdomínio</th>
                                            <th><i className="fas fa-network-wired"></i> IP</th>
                                            <th><i className="fas fa-certificate"></i> Status</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredSubdomains.map((sub, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="url-cell">{sub.subdomain}</span>
                                                </td>
                                                <td>{sub.ip_address || 'N/A'}</td>
                                                <td>
                                                    <span className="severity-badge severity-info">
                                                        <i className="fas fa-check-circle"></i> Ativo
                                                    </span>
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => copyToClipboard(sub.subdomain)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // Nuclei Tab
        function NucleiTab({ token, domain }) {
            const [vulnerabilities, setVulnerabilities] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [severityFilter, setSeverityFilter] = useState('all');
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 50; // Pagination to prevent browser freeze

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchVulnerabilities();
                }
            }, [domain]);

            const fetchVulnerabilities = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/nuclei`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setVulnerabilities(data);
                        setCurrentPage(1); // Reset to first page
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredVulns = vulnerabilities.filter(vuln => {
                // Access nested properties correctly
                const templateName = vuln.info?.name || vuln.template_id || '';
                const matchedUrl = vuln.matched_at || '';
                const vulnSeverity = vuln.info?.severity || 'info';

                const matchesSearch = templateName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    matchedUrl.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSeverity = severityFilter === 'all' || vulnSeverity.toLowerCase() === severityFilter.toLowerCase();
                return matchesSearch && matchesSeverity;
            });

            // Pagination logic
            const totalPages = Math.ceil(filteredVulns.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedVulns = filteredVulns.slice(startIndex, endIndex);

            const getSeverityClass = (severity) => {
                const severityMap = {
                    'critical': 'severity-critical',
                    'high': 'severity-high',
                    'medium': 'severity-medium',
                    'low': 'severity-low',
                    'info': 'severity-info'
                };
                return severityMap[severity?.toLowerCase()] || 'severity-info';
            };

            const getSeverityIcon = (severity) => {
                const iconMap = {
                    'critical': 'fa-skull-crossbones',
                    'high': 'fa-exclamation-triangle',
                    'medium': 'fa-exclamation-circle',
                    'low': 'fa-info-circle',
                    'info': 'fa-info'
                };
                return iconMap[severity?.toLowerCase()] || 'fa-info';
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-bug"></i> Vulnerabilidades</h2>
                            <span className="header-badge">{filteredVulns.length} detectadas</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchVulnerabilities}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-file-pdf"></i> Gerar Relatório
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar vulnerabilidade..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select className="filter-select" value={severityFilter} onChange={(e) => setSeverityFilter(e.target.value)}>
                            <option value="all">Todas Severidades</option>
                            <option value="critical">Crítica</option>
                            <option value="high">Alta</option>
                            <option value="medium">Média</option>
                            <option value="low">Baixa</option>
                            <option value="info">Info</option>
                        </select>
                        <button className="btn-filter">
                            <i className="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-shield-alt"></i> Análise de Segurança
                                <span className="data-card-count">{filteredVulns.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Analisando vulnerabilidades...</div>
                                </div>
                            ) : filteredVulns.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-shield-check"></i></div>
                                    <div className="empty-text">Nenhuma vulnerabilidade encontrada</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-file-code"></i> Template</th>
                                            <th><i className="fas fa-exclamation-circle"></i> Severidade</th>
                                            <th><i className="fas fa-link"></i> URL Afetada</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {paginatedVulns.map((vuln, index) => {
                                            const templateName = vuln.info?.name || vuln.template_id || 'Unknown';
                                            const matchedUrl = vuln.matched_at || vuln.host || 'N/A';
                                            const severity = vuln.info?.severity || 'info';
                                            const globalIndex = startIndex + index + 1;

                                            return (
                                                <tr key={globalIndex}>
                                                    <td>{globalIndex}</td>
                                                    <td title={templateName}>
                                                        <div style={{maxWidth: '300px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap'}}>
                                                            {templateName}
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span className={`severity-badge ${getSeverityClass(severity)}`}>
                                                            <i className={`fas ${getSeverityIcon(severity)}`}></i> {severity?.toUpperCase() || 'INFO'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span className="url-cell" title={matchedUrl}>
                                                            <div style={{maxWidth: '400px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap'}}>
                                                                {matchedUrl}
                                                            </div>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <button className="btn-copy" onClick={() => navigator.clipboard.writeText(matchedUrl)}>
                                                            <i className="fas fa-copy"></i> Copiar
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            )}

                            {/* Pagination Controls */}
                            {filteredVulns.length > itemsPerPage && (
                                <div style={{
                                    display: 'flex',
                                    justifyContent: 'center',
                                    alignItems: 'center',
                                    gap: '10px',
                                    marginTop: '20px',
                                    padding: '15px'
                                }}>
                                    <button
                                        className="btn-action"
                                        onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                                        disabled={currentPage === 1}
                                        style={{opacity: currentPage === 1 ? 0.5 : 1}}
                                    >
                                        <i className="fas fa-chevron-left"></i> Anterior
                                    </button>
                                    <span style={{color: 'var(--text-gray)', fontSize: '14px'}}>
                                        Página {currentPage} de {totalPages} ({filteredVulns.length} total)
                                    </span>
                                    <button
                                        className="btn-action"
                                        onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}
                                        disabled={currentPage === totalPages}
                                        style={{opacity: currentPage === totalPages ? 0.5 : 1}}
                                    >
                                        Próxima <i className="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // JS Secrets Tab

        // ================================================================================
        // Vulnerabilities Detailed Tab with POC
        // ================================================================================
        function VulnerabilitiesDetailedTab({ token, domain }) {
    const [vulnerabilities, setVulnerabilities] = useState([]);
    const [loading, setLoading] = useState(true);
    const [searchTerm, setSearchTerm] = useState('');
    const [severityFilter, setSeverityFilter] = useState('all');
    const [selectedVuln, setSelectedVuln] = useState(null);
    const [showPocModal, setShowPocModal] = useState(false);
    const [currentPage, setCurrentPage] = useState(1);
    const itemsPerPage = 20;

    useEffect(() => {
        if (domain && domain !== 'all') {
            fetchVulnerabilities();
        }
    }, [domain]);

    const fetchVulnerabilities = async () => {
        setLoading(true);
        try {
            const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/nuclei`, {
                headers: { 'Authorization': `Bearer ${token}` },
            });
            if (response.ok) {
                const data = await response.json();
                setVulnerabilities(data);
                setCurrentPage(1);
            }
        } catch (err) {
            console.error('Error:', err);
        } finally {
            setLoading(false);
        }
    };

    const filteredVulns = vulnerabilities.filter(vuln => {
        const templateName = vuln.info?.name || vuln.template_id || '';
        const matchedUrl = vuln.matched_at || '';
        const vulnSeverity = vuln.info?.severity || 'info';

        const matchesSearch = templateName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            matchedUrl.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            vuln.template_id.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesSeverity = severityFilter === 'all' || vulnSeverity.toLowerCase() === severityFilter.toLowerCase();
        return matchesSearch && matchesSeverity;
    });

    // Estatísticas
    const stats = {
        critical: vulnerabilities.filter(v => v.info?.severity?.toLowerCase() === 'critical').length,
        high: vulnerabilities.filter(v => v.info?.severity?.toLowerCase() === 'high').length,
        medium: vulnerabilities.filter(v => v.info?.severity?.toLowerCase() === 'medium').length,
        low: vulnerabilities.filter(v => v.info?.severity?.toLowerCase() === 'low').length,
    };

    // Pagination
    const totalPages = Math.ceil(filteredVulns.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedVulns = filteredVulns.slice(startIndex, endIndex);

    const getSeverityColor = (severity) => {
        const map = {
            'critical': '#ef4444',
            'high': '#f97316',
            'medium': '#f59e0b',
            'low': '#3b82f6',
            'info': '#6b7280'
        };
        return map[severity?.toLowerCase()] || '#6b7280';
    };

    const getSeverityIcon = (severity) => {
        const map = {
            'critical': 'fa-skull-crossbones',
            'high': 'fa-exclamation-triangle',
            'medium': 'fa-exclamation-circle',
            'low': 'fa-info-circle',
            'info': 'fa-info'
        };
        return map[severity?.toLowerCase()] || 'fa-info';
    };

    const formatHttpContent = (content) => {
        if (!content) return 'N/A';
        return content.split('\\n').map((line, i) => (
            <div key={i} style={{fontFamily: 'monospace', fontSize: '13px', lineHeight: '1.6'}}>
                {line}
            </div>
        ));
    };

    const openPocModal = (vuln) => {
        setSelectedVuln(vuln);
        setShowPocModal(true);
    };

    const closePocModal = () => {
        setShowPocModal(false);
        setSelectedVuln(null);
    };

    const PocModal = ({ vuln, onClose }) => {
        if (!vuln) return null;

        return (
            <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                zIndex: 10000,
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                padding: '20px',
                overflow: 'auto'
            }} onClick={onClose}>
                <div style={{
                    backgroundColor: 'var(--card-bg)',
                    borderRadius: '16px',
                    maxWidth: '1200px',
                    width: '100%',
                    maxHeight: '90vh',
                    overflow: 'auto',
                    padding: '30px',
                    border: `3px solid ${getSeverityColor(vuln.info?.severity)}`,
                    boxShadow: '0 25px 50px rgba(0, 0, 0, 0.5)'
                }} onClick={(e) => e.stopPropagation()}>
                    {/* Header */}
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '25px'}}>
                        <div style={{flex: 1}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px'}}>
                                <i className={`fas ${getSeverityIcon(vuln.info?.severity)}`} style={{
                                    fontSize: '28px',
                                    color: getSeverityColor(vuln.info?.severity)
                                }}></i>
                                <h2 style={{margin: 0, fontSize: '24px', fontWeight: '700', color: '#fff'}}>
                                    {vuln.info?.name || vuln.template_id}
                                </h2>
                            </div>
                            <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                                <span style={{
                                    padding: '6px 14px',
                                    borderRadius: '6px',
                                    fontSize: '13px',
                                    fontWeight: '600',
                                    backgroundColor: getSeverityColor(vuln.info?.severity),
                                    color: '#fff'
                                }}>
                                    {vuln.info?.severity?.toUpperCase() || 'INFO'}
                                </span>
                                <span style={{
                                    padding: '6px 14px',
                                    borderRadius: '6px',
                                    fontSize: '13px',
                                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                    color: '#3b82f6'
                                }}>
                                    {vuln.template_id}
                                </span>
                            </div>
                        </div>
                        <button onClick={onClose} style={{
                            background: 'rgba(239, 68, 68, 0.2)',
                            border: 'none',
                            color: '#ef4444',
                            fontSize: '24px',
                            cursor: 'pointer',
                            width: '40px',
                            height: '40px',
                            borderRadius: '8px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center'
                        }}>
                            <i className="fas fa-times"></i>
                        </button>
                    </div>

                    {/* Description */}
                    {vuln.info?.description && (
                        <div style={{
                            padding: '16px',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderLeft: '4px solid #3b82f6',
                            borderRadius: '8px',
                            marginBottom: '25px'
                        }}>
                            <div style={{fontSize: '14px', lineHeight: '1.6', color: 'var(--text-gray)'}}>
                                {vuln.info.description}
                            </div>
                        </div>
                    )}

                    {/* Target & Template Info */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                        gap: '15px',
                        marginBottom: '25px'
                    }}>
                        <div style={{
                            padding: '15px',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderRadius: '8px',
                            border: '1px solid rgba(16, 185, 129, 0.3)'
                        }}>
                            <div style={{fontSize: '12px', color: '#10b981', marginBottom: '5px', fontWeight: '600'}}>
                                <i className="fas fa-bullseye"></i> TARGET
                            </div>
                            <div style={{fontSize: '14px', color: '#fff', wordBreak: 'break-all'}}>
                                {vuln.host}
                            </div>
                        </div>
                        <div style={{
                            padding: '15px',
                            backgroundColor: 'rgba(147, 51, 234, 0.1)',
                            borderRadius: '8px',
                            border: '1px solid rgba(147, 51, 234, 0.3)'
                        }}>
                            <div style={{fontSize: '12px', color: '#9333ea', marginBottom: '5px', fontWeight: '600'}}>
                                <i className="fas fa-link"></i> MATCHED AT
                            </div>
                            <div style={{fontSize: '14px', color: '#fff', wordBreak: 'break-all'}}>
                                {vuln.matched_at}
                            </div>
                        </div>
                        {vuln.vuln_type && (
                            <div style={{
                                padding: '15px',
                                backgroundColor: 'rgba(249, 115, 22, 0.1)',
                                borderRadius: '8px',
                                border: '1px solid rgba(249, 115, 22, 0.3)'
                            }}>
                                <div style={{fontSize: '12px', color: '#f97316', marginBottom: '5px', fontWeight: '600'}}>
                                    <i className="fas fa-tag"></i> TYPE
                                </div>
                                <div style={{fontSize: '14px', color: '#fff'}}>
                                    {vuln.vuln_type}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* POC Section */}
                    <div style={{marginTop: '30px'}}>
                        <h3 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            marginBottom: '20px',
                            color: '#fff',
                            borderBottom: '2px solid rgba(16, 185, 129, 0.3)',
                            paddingBottom: '10px'
                        }}>
                            <i className="fas fa-code"></i> Proof of Concept (POC)
                        </h3>

                        {/* Request */}
                        {vuln.request && (
                            <div style={{marginBottom: '20px'}}>
                                <div style={{
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    padding: '12px 16px',
                                    borderRadius: '8px 8px 0 0',
                                    borderLeft: '4px solid #ef4444',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <span style={{fontSize: '14px', fontWeight: '600', color: '#ef4444'}}>
                                        <i className="fas fa-arrow-up"></i> HTTP REQUEST
                                    </span>
                                    <button onClick={() => navigator.clipboard.writeText(vuln.request)} style={{
                                        background: 'rgba(239, 68, 68, 0.2)',
                                        border: '1px solid #ef4444',
                                        color: '#ef4444',
                                        padding: '6px 12px',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '12px'
                                    }}>
                                        <i className="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div style={{
                                    backgroundColor: '#0f172a',
                                    padding: '20px',
                                    borderRadius: '0 0 8px 8px',
                                    border: '1px solid rgba(239, 68, 68, 0.3)',
                                    borderTop: 'none',
                                    overflowX: 'auto',
                                    maxHeight: '400px'
                                }}>
                                    <pre style={{
                                        margin: 0,
                                        fontSize: '13px',
                                        lineHeight: '1.8',
                                        color: '#f8fafc',
                                        fontFamily: "'Fira Code', 'Courier New', monospace"
                                    }}>
                                        {vuln.request}
                                    </pre>
                                </div>
                            </div>
                        )}

                        {/* Response */}
                        {vuln.response && (
                            <div style={{marginBottom: '20px'}}>
                                <div style={{
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    padding: '12px 16px',
                                    borderRadius: '8px 8px 0 0',
                                    borderLeft: '4px solid #10b981',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <span style={{fontSize: '14px', fontWeight: '600', color: '#10b981'}}>
                                        <i className="fas fa-arrow-down"></i> HTTP RESPONSE
                                    </span>
                                    <button onClick={() => navigator.clipboard.writeText(vuln.response)} style={{
                                        background: 'rgba(16, 185, 129, 0.2)',
                                        border: '1px solid #10b981',
                                        color: '#10b981',
                                        padding: '6px 12px',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '12px'
                                    }}>
                                        <i className="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div style={{
                                    backgroundColor: '#0f172a',
                                    padding: '20px',
                                    borderRadius: '0 0 8px 8px',
                                    border: '1px solid rgba(16, 185, 129, 0.3)',
                                    borderTop: 'none',
                                    overflowX: 'auto',
                                    maxHeight: '400px'
                                }}>
                                    <pre style={{
                                        margin: 0,
                                        fontSize: '13px',
                                        lineHeight: '1.8',
                                        color: '#f8fafc',
                                        fontFamily: "'Fira Code', 'Courier New', monospace"
                                    }}>
                                        {vuln.response}
                                    </pre>
                                </div>
                            </div>
                        )}

                        {/* cURL Command */}
                        {vuln.curl_command && (
                            <div style={{marginBottom: '20px'}}>
                                <div style={{
                                    backgroundColor: 'rgba(147, 51, 234, 0.1)',
                                    padding: '12px 16px',
                                    borderRadius: '8px 8px 0 0',
                                    borderLeft: '4px solid #9333ea',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <span style={{fontSize: '14px', fontWeight: '600', color: '#9333ea'}}>
                                        <i className="fas fa-terminal"></i> cURL COMMAND
                                    </span>
                                    <button onClick={() => navigator.clipboard.writeText(vuln.curl_command)} style={{
                                        background: 'rgba(147, 51, 234, 0.2)',
                                        border: '1px solid #9333ea',
                                        color: '#9333ea',
                                        padding: '6px 12px',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '12px'
                                    }}>
                                        <i className="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div style={{
                                    backgroundColor: '#0f172a',
                                    padding: '20px',
                                    borderRadius: '0 0 8px 8px',
                                    border: '1px solid rgba(147, 51, 234, 0.3)',
                                    borderTop: 'none',
                                    overflowX: 'auto'
                                }}>
                                    <pre style={{
                                        margin: 0,
                                        fontSize: '13px',
                                        lineHeight: '1.8',
                                        color: '#f8fafc',
                                        fontFamily: "'Fira Code', 'Courier New', monospace",
                                        whiteSpace: 'pre-wrap',
                                        wordBreak: 'break-all'
                                    }}>
                                        {vuln.curl_command}
                                    </pre>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Tags & References */}
                    {(vuln.info?.tags || vuln.info?.reference) && (
                        <div style={{marginTop: '30px', paddingTop: '20px', borderTop: '1px solid var(--border-color)'}}>
                            {vuln.info?.tags && vuln.info.tags.length > 0 && (
                                <div style={{marginBottom: '15px'}}>
                                    <div style={{fontSize: '13px', color: 'var(--text-gray)', marginBottom: '8px'}}>
                                        <i className="fas fa-tags"></i> Tags:
                                    </div>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {vuln.info.tags.map((tag, i) => (
                                            <span key={i} style={{
                                                padding: '4px 10px',
                                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                                border: '1px solid rgba(59, 130, 246, 0.3)',
                                                borderRadius: '4px',
                                                fontSize: '12px',
                                                color: '#3b82f6'
                                            }}>
                                                {tag}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            )}
                            {vuln.info?.reference && vuln.info.reference.length > 0 && (
                                <div>
                                    <div style={{fontSize: '13px', color: 'var(--text-gray)', marginBottom: '8px'}}>
                                        <i className="fas fa-book"></i> References:
                                    </div>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '6px'}}>
                                        {vuln.info.reference.map((ref, i) => (
                                            <a key={i} href={ref} target="_blank" rel="noopener noreferrer" style={{
                                                color: '#3b82f6',
                                                fontSize: '13px',
                                                textDecoration: 'none',
                                                wordBreak: 'break-all'
                                            }}>
                                                <i className="fas fa-external-link-alt"></i> {ref}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Close Button */}
                    <div style={{marginTop: '30px', display: 'flex', justifyContent: 'flex-end'}}>
                        <button onClick={onClose} style={{
                            padding: '12px 24px',
                            background: 'linear-gradient(135deg, var(--primary-green), var(--primary-purple))',
                            border: 'none',
                            borderRadius: '8px',
                            color: '#fff',
                            fontSize: '14px',
                            fontWeight: '600',
                            cursor: 'pointer'
                        }}>
                            <i className="fas fa-times"></i> Fechar
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    return (
        <>
            <div className="content-header">
                <div className="header-title">
                    <h2><i className="fas fa-shield-virus"></i> Vulnerabilidades Detalhadas</h2>
                    <span className="header-badge">{filteredVulns.length} encontradas</span>
                </div>
                <div className="header-actions">
                    <button className="btn-action" onClick={fetchVulnerabilities}>
                        <i className="fas fa-sync-alt"></i> Atualizar
                    </button>
                    <button className="btn-action">
                        <i className="fas fa-file-pdf"></i> Gerar Relatório
                    </button>
                </div>
            </div>

            {/* Statistics Cards */}
            <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '15px',
                marginBottom: '25px'
            }}>
                <div style={{
                    background: 'linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%)',
                    border: '2px solid rgba(239, 68, 68, 0.3)',
                    borderRadius: '12px',
                    padding: '20px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '15px'
                }}>
                    <div style={{
                        width: '50px',
                        height: '50px',
                        borderRadius: '12px',
                        background: 'rgba(239, 68, 68, 0.2)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        color: '#ef4444'
                    }}>
                        <i className="fas fa-skull-crossbones"></i>
                    </div>
                    <div>
                        <div style={{fontSize: '28px', fontWeight: '700', color: '#ef4444'}}>{stats.critical}</div>
                        <div style={{fontSize: '13px', color: 'var(--text-gray)'}}>Critical</div>
                    </div>
                </div>
                <div style={{
                    background: 'linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(249, 115, 22, 0.05) 100%)',
                    border: '2px solid rgba(249, 115, 22, 0.3)',
                    borderRadius: '12px',
                    padding: '20px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '15px'
                }}>
                    <div style={{
                        width: '50px',
                        height: '50px',
                        borderRadius: '12px',
                        background: 'rgba(249, 115, 22, 0.2)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        color: '#f97316'
                    }}>
                        <i className="fas fa-exclamation-triangle"></i>
                    </div>
                    <div>
                        <div style={{fontSize: '28px', fontWeight: '700', color: '#f97316'}}>{stats.high}</div>
                        <div style={{fontSize: '13px', color: 'var(--text-gray)'}}>High</div>
                    </div>
                </div>
                <div style={{
                    background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%)',
                    border: '2px solid rgba(245, 158, 11, 0.3)',
                    borderRadius: '12px',
                    padding: '20px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '15px'
                }}>
                    <div style={{
                        width: '50px',
                        height: '50px',
                        borderRadius: '12px',
                        background: 'rgba(245, 158, 11, 0.2)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        color: '#f59e0b'
                    }}>
                        <i className="fas fa-exclamation-circle"></i>
                    </div>
                    <div>
                        <div style={{fontSize: '28px', fontWeight: '700', color: '#f59e0b'}}>{stats.medium}</div>
                        <div style={{fontSize: '13px', color: 'var(--text-gray)'}}>Medium</div>
                    </div>
                </div>
                <div style={{
                    background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%)',
                    border: '2px solid rgba(59, 130, 246, 0.3)',
                    borderRadius: '12px',
                    padding: '20px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '15px'
                }}>
                    <div style={{
                        width: '50px',
                        height: '50px',
                        borderRadius: '12px',
                        background: 'rgba(59, 130, 246, 0.2)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        color: '#3b82f6'
                    }}>
                        <i className="fas fa-info-circle"></i>
                    </div>
                    <div>
                        <div style={{fontSize: '28px', fontWeight: '700', color: '#3b82f6'}}>{stats.low}</div>
                        <div style={{fontSize: '13px', color: 'var(--text-gray)'}}>Low</div>
                    </div>
                </div>
            </div>

            {/* Filters */}
            <div className="filter-bar">
                <input
                    type="text"
                    className="search-input"
                    placeholder="🔍 Buscar por nome, template ID ou URL..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
                <select className="filter-select" value={severityFilter} onChange={(e) => setSeverityFilter(e.target.value)}>
                    <option value="all">Todas Severidades</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                    <option value="info">Info</option>
                </select>
            </div>

            {/* Vulnerabilities List */}
            {loading ? (
                <div className="loading-container">
                    <div className="loading-spinner"></div>
                    <div className="loading-text">Carregando vulnerabilidades...</div>
                </div>
            ) : filteredVulns.length === 0 ? (
                <div className="empty-state">
                    <div className="empty-icon"><i className="fas fa-shield-check"></i></div>
                    <div className="empty-text">Nenhuma vulnerabilidade encontrada</div>
                </div>
            ) : (
                <>
                    <div style={{display: 'grid', gap: '15px'}}>
                        {paginatedVulns.map((vuln, index) => (
                            <div key={index} style={{
                                backgroundColor: 'var(--card-bg)',
                                borderRadius: '12px',
                                padding: '20px',
                                border: `2px solid ${getSeverityColor(vuln.info?.severity)}`,
                                cursor: 'pointer',
                                transition: 'all 0.3s',
                                ':hover': {
                                    transform: 'translateY(-2px)',
                                    boxShadow: `0 8px 24px ${getSeverityColor(vuln.info?.severity)}40`
                                }
                            }} onClick={() => openPocModal(vuln)}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px'}}>
                                    <div style={{flex: 1}}>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px'}}>
                                            <i className={`fas ${getSeverityIcon(vuln.info?.severity)}`} style={{
                                                fontSize: '20px',
                                                color: getSeverityColor(vuln.info?.severity)
                                            }}></i>
                                            <h3 style={{margin: 0, fontSize: '18px', fontWeight: '600', color: '#fff'}}>
                                                {vuln.info?.name || vuln.template_id}
                                            </h3>
                                        </div>
                                        <div style={{fontSize: '13px', color: 'var(--text-gray)', marginBottom: '8px'}}>
                                            <i className="fas fa-code"></i> Template: <span style={{
                                                color: '#3b82f6',
                                                fontFamily: 'monospace'
                                            }}>{vuln.template_id}</span>
                                        </div>
                                    </div>
                                    <span style={{
                                        padding: '8px 16px',
                                        borderRadius: '8px',
                                        fontSize: '13px',
                                        fontWeight: '600',
                                        backgroundColor: getSeverityColor(vuln.info?.severity),
                                        color: '#fff'
                                    }}>
                                        {vuln.info?.severity?.toUpperCase() || 'INFO'}
                                    </span>
                                </div>
                                <div style={{fontSize: '14px', color: 'var(--text-gray)', marginBottom: '12px'}}>
                                    <i className="fas fa-link"></i> <span style={{wordBreak: 'break-all'}}>{vuln.matched_at}</span>
                                </div>
                                {vuln.info?.description && (
                                    <div style={{
                                        fontSize: '13px',
                                        color: 'var(--text-gray)',
                                        lineHeight: '1.6',
                                        marginBottom: '15px',
                                        padding: '12px',
                                        backgroundColor: 'rgba(59, 130, 246, 0.05)',
                                        borderRadius: '6px',
                                        borderLeft: '3px solid #3b82f6'
                                    }}>
                                        {vuln.info.description.substring(0, 200)}{vuln.info.description.length > 200 ? '...' : ''}
                                    </div>
                                )}
                                <div style={{display: 'flex', gap: '10px', alignItems: 'center'}}>
                                    <button style={{
                                        padding: '10px 20px',
                                        background: 'linear-gradient(135deg, var(--primary-green), var(--primary-purple))',
                                        border: 'none',
                                        borderRadius: '8px',
                                        color: '#fff',
                                        fontSize: '14px',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }}>
                                        <i className="fas fa-eye"></i> Ver POC Completo
                                    </button>
                                    {(vuln.request || vuln.response || vuln.curl_command) && (
                                        <span style={{
                                            fontSize: '13px',
                                            color: '#10b981',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '6px'
                                        }}>
                                            <i className="fas fa-check-circle"></i> POC Disponível
                                        </span>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Pagination */}
                    {filteredVulns.length > itemsPerPage && (
                        <div style={{
                            display: 'flex',
                            justifyContent: 'center',
                            alignItems: 'center',
                            gap: '10px',
                            marginTop: '25px',
                            padding: '20px'
                        }}>
                            <button
                                className="btn-action"
                                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                                disabled={currentPage === 1}
                                style={{opacity: currentPage === 1 ? 0.5 : 1}}
                            >
                                <i className="fas fa-chevron-left"></i> Anterior
                            </button>
                            <span style={{color: 'var(--text-gray)', fontSize: '14px', fontWeight: '600'}}>
                                Página {currentPage} de {totalPages} ({filteredVulns.length} total)
                            </span>
                            <button
                                className="btn-action"
                                onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}
                                disabled={currentPage === totalPages}
                                style={{opacity: currentPage === totalPages ? 0.5 : 1}}
                            >
                                Próxima <i className="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    )}
                </>
            )}

            {/* POC Modal */}
            {showPocModal && selectedVuln && (
                <PocModal vuln={selectedVuln} onClose={closePocModal} />
            )}
        </>
    );
}


        function JsSecretsTab({ token, domain }) {
            const [secrets, setSecrets] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchSecrets();
                }
            }, [domain]);

            const fetchSecrets = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/js_secrets`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setSecrets(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredSecrets = secrets.filter(secret =>
                secret.secret_type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                secret.secret_value.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-key"></i> Secrets Expostos</h2>
                            <span className="header-badge">{filteredSecrets.length} encontrados</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchSecrets}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-bell"></i> Configurar Alertas
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar secret..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select className="filter-select">
                            <option>Todos os Tipos</option>
                            <option>AWS Keys</option>
                            <option>API Tokens</option>
                            <option>Passwords</option>
                        </select>
                        <button className="btn-filter">
                            <i className="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-user-secret"></i> Credenciais Detectadas
                                <span className="data-card-count">{filteredSecrets.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Analisando secrets...</div>
                                </div>
                            ) : filteredSecrets.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-lock"></i></div>
                                    <div className="empty-text">Nenhum secret encontrado</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-tag"></i> Tipo</th>
                                            <th><i className="fas fa-key"></i> Valor</th>
                                            <th><i className="fas fa-link"></i> Origem</th>
                                            <th><i className="fas fa-check-circle"></i> Status</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredSecrets.map((secret, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="severity-badge severity-critical">
                                                        <i className="fas fa-shield-alt"></i> {secret.secret_type}
                                                    </span>
                                                </td>
                                                <td style={{fontFamily: 'monospace', fontSize: '12px'}}>{secret.secret_value}</td>
                                                <td>
                                                    <span className="url-cell">{secret.source_url}</span>
                                                </td>
                                                <td>
                                                    {secret.validation_status ? (
                                                        <span className="severity-badge severity-success">
                                                            <i className="fas fa-check"></i> {secret.validation_status}
                                                        </span>
                                                    ) : (
                                                        <span className="severity-badge severity-info">
                                                            <i className="fas fa-question"></i> N/A
                                                        </span>
                                                    )}
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => navigator.clipboard.writeText(secret.secret_value)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // Hardcoded Secrets Tab
        function HardcodedSecretsTab({ token, domain }) {
            const [secrets, setSecrets] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [severityFilter, setSeverityFilter] = useState('all');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchSecrets();
                }
            }, [domain]);

            const fetchSecrets = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/hardcoded_secrets`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setSecrets(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredSecrets = secrets.filter(secret => {
                const matchesSearch = secret.secret_type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    secret.found_in_url.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    secret.secret_preview.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSeverity = severityFilter === 'all' || secret.severity.toLowerCase() === severityFilter.toLowerCase();
                return matchesSearch && matchesSeverity;
            });

            const getSeverityColor = (severity) => {
                switch(severity.toLowerCase()) {
                    case 'critical': return '#ef4444';
                    case 'high': return '#f97316';
                    case 'medium': return '#f59e0b';
                    case 'low': return '#3b82f6';
                    default: return '#6b7280';
                }
            };

            const getSeverityIcon = (severity) => {
                switch(severity.toLowerCase()) {
                    case 'critical': return 'fa-skull-crossbones';
                    case 'high': return 'fa-exclamation-triangle';
                    case 'medium': return 'fa-exclamation-circle';
                    case 'low': return 'fa-info-circle';
                    default: return 'fa-question-circle';
                }
            };

            const getValidationBadge = (secret) => {
                if (!secret.validated) {
                    return <span className="badge" style={{backgroundColor: '#6b7280'}}>NOT VALIDATED</span>;
                }
                if (secret.validation_status === 'ACTIVE') {
                    return <span className="badge" style={{backgroundColor: '#ef4444'}}>ACTIVE</span>;
                } else if (secret.validation_status === 'INVALID') {
                    return <span className="badge" style={{backgroundColor: '#22c55e'}}>INVALID</span>;
                } else {
                    return <span className="badge" style={{backgroundColor: '#f59e0b'}}>{secret.validation_status}</span>;
                }
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-shield-alt"></i> Hardcoded Secrets</h2>
                            <span className="header-badge">{filteredSecrets.length} encontrados</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchSecrets}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar por tipo, URL ou preview..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select
                            className="filter-select"
                            value={severityFilter}
                            onChange={(e) => setSeverityFilter(e.target.value)}
                        >
                            <option value="all">Todas Severidades</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>

                    {loading ? (
                        <div className="loading">Carregando...</div>
                    ) : filteredSecrets.length === 0 ? (
                        <div className="empty-state">
                            <i className="fas fa-shield-alt"></i>
                            <p>Nenhum hardcoded secret encontrado</p>
                        </div>
                    ) : (
                        <div className="data-grid">
                            {filteredSecrets.map((secret, idx) => (
                                <div key={idx} className="data-card">
                                    <div className="card-header" style={{borderLeftColor: getSeverityColor(secret.severity)}}>
                                        <div>
                                            <h3>
                                                <i className={`fas ${getSeverityIcon(secret.severity)}`}></i> {secret.secret_type}
                                            </h3>
                                            <span className="badge" style={{backgroundColor: getSeverityColor(secret.severity)}}>
                                                {secret.severity}
                                            </span>
                                            {getValidationBadge(secret)}
                                        </div>
                                    </div>
                                    <div className="card-body">
                                        <p><strong>Preview:</strong> <code style={{backgroundColor: '#1e293b', padding: '4px 8px', borderRadius: '4px'}}>{secret.secret_preview}</code></p>
                                        <p><strong>Found in:</strong> <a href={secret.found_in_url} target="_blank" rel="noopener noreferrer" style={{color: '#3b82f6', textDecoration: 'none'}}>{secret.found_in_url}</a></p>
                                        <p><strong>Context:</strong> <code style={{fontSize: '12px', backgroundColor: '#1e293b', padding: '4px 8px', borderRadius: '4px', display: 'block', marginTop: '4px', wordBreak: 'break-all'}}>{secret.context}</code></p>
                                        <p><strong>Discovered:</strong> {new Date(secret.discovered_at).toLocaleString('pt-BR')}</p>
                                        {secret.validated && (
                                            <p style={{marginTop: '8px'}}>
                                                <strong>Validation Status:</strong>
                                                <span style={{
                                                    marginLeft: '8px',
                                                    color: secret.validation_status === 'ACTIVE' ? '#ef4444' : '#22c55e',
                                                    fontWeight: 'bold'
                                                }}>
                                                    {secret.validation_status === 'ACTIVE' ? '⚠️ ACTIVE - IMMEDIATE ACTION REQUIRED' : '✓ ' + secret.validation_status}
                                                </span>
                                            </p>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </>
            );
        }

        // JS Endpoints Tab
        function JsEndpointsTab({ token, domain }) {
            const [endpoints, setEndpoints] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchEndpoints();
                }
            }, [domain]);

            const fetchEndpoints = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/js_endpoints`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setEndpoints(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredEndpoints = endpoints.filter(ep =>
                ep.endpoint.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-code"></i> Endpoints JavaScript</h2>
                            <span className="header-badge">{filteredEndpoints.length} encontrados</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchEndpoints}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-download"></i> Exportar Lista
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar endpoint..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select className="filter-select">
                            <option>Todos os Métodos</option>
                            <option>GET</option>
                            <option>POST</option>
                            <option>PUT</option>
                            <option>DELETE</option>
                        </select>
                        <button className="btn-filter">
                            <i className="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-network-wired"></i> API Endpoints Descobertos
                                <span className="data-card-count">{filteredEndpoints.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Carregando endpoints...</div>
                                </div>
                            ) : filteredEndpoints.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-code-branch"></i></div>
                                    <div className="empty-text">Nenhum endpoint encontrado</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-route"></i> Endpoint</th>
                                            <th><i className="fas fa-tags"></i> Método</th>
                                            <th><i className="fas fa-link"></i> Fonte</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredEndpoints.map((ep, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td style={{fontFamily: 'monospace', fontSize: '13px'}}>{ep.endpoint}</td>
                                                <td>
                                                    <span className="severity-badge severity-info">
                                                        <i className="fas fa-arrow-right"></i> {ep.method || 'UNKNOWN'}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span className="url-cell">{ep.source_url}</span>
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => navigator.clipboard.writeText(ep.endpoint)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // Access Pages Tab
        function AccessPagesTab({ token, domain }) {
            const [pages, setPages] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchPages();
                }
            }, [domain]);

            const fetchPages = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/access_pages`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setPages(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredPages = pages.filter(page =>
                page.url.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-file"></i> Páginas Acessadas</h2>
                            <span className="header-badge">{filteredPages.length} páginas</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchPages}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar página..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select className="filter-select">
                            <option>Todos os Tipos</option>
                            <option>text/html</option>
                            <option>application/json</option>
                            <option>text/plain</option>
                        </select>
                        <button className="btn-filter">
                            <i className="fas fa-filter"></i> Filtrar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-browser"></i> Páginas Descobertas
                                <span className="data-card-count">{filteredPages.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Carregando páginas...</div>
                                </div>
                            ) : filteredPages.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-file-alt"></i></div>
                                    <div className="empty-text">Nenhuma página encontrada</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-link"></i> URL</th>
                                            <th><i className="fas fa-file-code"></i> Content-Type</th>
                                            <th><i className="fas fa-signal"></i> Status</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredPages.map((page, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="url-cell">{page.url}</span>
                                                </td>
                                                <td style={{fontSize: '12px'}}>{page.content_type}</td>
                                                <td>
                                                    <span className="severity-badge severity-success">
                                                        <i className="fas fa-check"></i> {page.status_code || '200'}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => navigator.clipboard.writeText(page.url)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // S3 Buckets Tab - Enhanced with All Cloud Storage Providers
        function S3BucketsTab({ token, domain }) {
            const [cloudStorage, setCloudStorage] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [providerFilter, setProviderFilter] = useState('all');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchCloudStorage();
                }
            }, [domain]);

            const fetchCloudStorage = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/cloud_storage`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setCloudStorage(data);
                    }
                } catch (err) {
                    console.error('Error fetching cloud storage:', err);
                } finally {
                    setLoading(false);
                }
            };

            const getProviderIcon = (provider) => {
                switch(provider) {
                    case 'AWS_S3': return 'fab fa-aws';
                    case 'GOOGLE_CLOUD_STORAGE': return 'fab fa-google';
                    case 'AZURE_BLOB': return 'fab fa-microsoft';
                    case 'DIGITALOCEAN_SPACES': return 'fab fa-digital-ocean';
                    default: return 'fas fa-cloud';
                }
            };

            const getSeverityColor = (riskLevel) => {
                switch(riskLevel.toUpperCase()) {
                    case 'CRITICAL': return 'severity-critical';
                    case 'HIGH': return 'severity-high';
                    case 'MEDIUM': return 'severity-medium';
                    case 'LOW': return 'severity-low';
                    default: return 'severity-info';
                }
            };

            const filteredStorage = cloudStorage.filter(storage => {
                const matchesSearch = storage.bucket_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     storage.bucket_url.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesProvider = providerFilter === 'all' || storage.provider === providerFilter;
                return matchesSearch && matchesProvider;
            });

            const totalCritical = cloudStorage.filter(s => s.risk_level === 'CRITICAL').length;
            const totalHigh = cloudStorage.filter(s => s.risk_level === 'HIGH').length;

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-cloud"></i> Cloud Storage & Buckets</h2>
                            <span className="header-badge">{filteredStorage.length} encontrados</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchCloudStorage}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                    </div>

                    {totalCritical > 0 && (
                        <div className="alert critical">
                            <div className="alert-icon"><i className="fas fa-exclamation-triangle"></i></div>
                            <div className="alert-content">
                                <div className="alert-title">Buckets Críticos Detectados!</div>
                                <div className="alert-message">{totalCritical} buckets com acesso público configurado incorretamente</div>
                            </div>
                        </div>
                    )}

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar bucket ou URL..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <select
                            className="filter-select"
                            value={providerFilter}
                            onChange={(e) => setProviderFilter(e.target.value)}
                        >
                            <option value="all">Todos Provedores</option>
                            <option value="AWS_S3">AWS S3</option>
                            <option value="GOOGLE_CLOUD_STORAGE">Google Cloud Storage</option>
                            <option value="AZURE_BLOB">Azure Blob</option>
                            <option value="DIGITALOCEAN_SPACES">DigitalOcean Spaces</option>
                        </select>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-database"></i> Cloud Storage Exposures
                                <span className="data-card-count">{filteredStorage.length}</span>
                            </div>
                            <div className="data-card-actions">
                                <span style={{color: 'var(--danger)', marginRight: '15px'}}>
                                    <i className="fas fa-radiation"></i> Critical: {totalCritical}
                                </span>
                                <span style={{color: 'var(--warning)'}}>
                                    <i className="fas fa-exclamation-triangle"></i> High: {totalHigh}
                                </span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Testando permissões de cloud storage...</div>
                                </div>
                            ) : filteredStorage.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-cloud-upload-alt"></i></div>
                                    <div className="empty-text">Nenhum cloud storage encontrado ou testado</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-server"></i> Provedor</th>
                                            <th><i className="fas fa-bucket"></i> Nome do Bucket</th>
                                            <th><i className="fas fa-link"></i> URL</th>
                                            <th><i className="fas fa-unlock-alt"></i> Permissões</th>
                                            <th><i className="fas fa-shield-alt"></i> Risco</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredStorage.map((storage, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="severity-badge severity-info">
                                                        <i className={getProviderIcon(storage.provider)}></i> {storage.provider.replace('_', ' ')}
                                                    </span>
                                                </td>
                                                <td>
                                                    <strong>{storage.bucket_name}</strong>
                                                </td>
                                                <td>
                                                    <span className="url-cell" style={{fontSize: '12px', wordBreak: 'break-all'}}>
                                                        {storage.bucket_url}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div style={{display: 'flex', gap: '5px', flexWrap: 'wrap'}}>
                                                        {storage.permissions.list && (
                                                            <span className="severity-badge severity-critical" style={{fontSize: '10px'}}>
                                                                <i className="fas fa-list"></i> LIST
                                                            </span>
                                                        )}
                                                        {storage.permissions.read && (
                                                            <span className="severity-badge severity-critical" style={{fontSize: '10px'}}>
                                                                <i className="fas fa-eye"></i> READ
                                                            </span>
                                                        )}
                                                        {storage.permissions.write && (
                                                            <span className="severity-badge severity-critical" style={{fontSize: '10px'}}>
                                                                <i className="fas fa-edit"></i> WRITE
                                                            </span>
                                                        )}
                                                        {!storage.permissions.list && !storage.permissions.read && !storage.permissions.write && (
                                                            <span className="severity-badge severity-low" style={{fontSize: '10px'}}>
                                                                <i className="fas fa-lock"></i> PRIVATE
                                                            </span>
                                                        )}
                                                    </div>
                                                </td>
                                                <td>
                                                    <span className={`severity-badge ${getSeverityColor(storage.risk_level)}`}>
                                                        {storage.risk_level}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button
                                                        className="btn-copy"
                                                        onClick={() => navigator.clipboard.writeText(storage.bucket_url)}
                                                        title="Copiar URL"
                                                    >
                                                        <i className="fas fa-copy"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // HTTP 200 Tab
        function Http200Tab({ token, domain }) {
            const [urls, setUrls] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchUrls();
                }
            }, [domain]);

            const fetchUrls = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/http200`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setUrls(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredUrls = urls.filter(urlObj =>
                urlObj.url.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-check-circle"></i> HTTP 200 - URLs Acessíveis</h2>
                            <span className="header-badge">{filteredUrls.length} URLs</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchUrls}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar URL..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <button className="btn-filter">
                            <i className="fas fa-search"></i> Buscar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-globe"></i> URLs com Status 200 OK
                                <span className="data-card-count">{filteredUrls.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Carregando URLs...</div>
                                </div>
                            ) : filteredUrls.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-link"></i></div>
                                    <div className="empty-text">Nenhuma URL 200 encontrada</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-link"></i> URL</th>
                                            <th><i className="fas fa-signal"></i> Status</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredUrls.map((urlObj, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="url-cell">{urlObj.url}</span>
                                                </td>
                                                <td>
                                                    <span className="severity-badge severity-success">
                                                        <i className="fas fa-check"></i> 200 OK
                                                    </span>
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => navigator.clipboard.writeText(urlObj.url)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // HTTP 403 Tab
        function Http403Tab({ token, domain }) {
            const [urls, setUrls] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (domain && domain !== 'all') {
                    fetchUrls();
                }
            }, [domain]);

            const fetchUrls = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/domain/${encodeURIComponent(domain)}/http403`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });
                    if (response.ok) {
                        const data = await response.json();
                        setUrls(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filteredUrls = urls.filter(urlObj =>
                urlObj.url.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-ban"></i> HTTP 403 - URLs Bloqueadas</h2>
                            <span className="header-badge">{filteredUrls.length} URLs</span>
                        </div>
                        <div className="header-actions">
                            <button className="btn-action" onClick={fetchUrls}>
                                <i className="fas fa-sync-alt"></i> Atualizar
                            </button>
                            <button className="btn-action">
                                <i className="fas fa-unlock"></i> Tentar Bypass
                            </button>
                        </div>
                    </div>

                    <div className="filter-bar">
                        <input
                            type="text"
                            className="search-input"
                            placeholder="🔍 Buscar URL..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <button className="btn-filter">
                            <i className="fas fa-search"></i> Buscar
                        </button>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-shield-alt"></i> URLs com Status 403 Forbidden
                                <span className="data-card-count">{filteredUrls.length}</span>
                            </div>
                        </div>
                        <div className="data-table">
                            {loading ? (
                                <div className="loading-container">
                                    <div className="loading-spinner"></div>
                                    <div className="loading-text">Carregando URLs...</div>
                                </div>
                            ) : filteredUrls.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon"><i className="fas fa-lock"></i></div>
                                    <div className="empty-text">Nenhuma URL 403 encontrada</div>
                                </div>
                            ) : (
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-link"></i> URL</th>
                                            <th><i className="fas fa-signal"></i> Status</th>
                                            <th><i className="fas fa-tools"></i> Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredUrls.map((urlObj, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>
                                                    <span className="url-cell">{urlObj.url}</span>
                                                </td>
                                                <td>
                                                    <span className="severity-badge severity-high">
                                                        <i className="fas fa-ban"></i> 403 Forbidden
                                                    </span>
                                                </td>
                                                <td>
                                                    <button className="btn-copy" onClick={() => navigator.clipboard.writeText(urlObj.url)}>
                                                        <i className="fas fa-copy"></i> Copiar
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // GitHub Tab Component
        function GitHubTab({ token }) {
            const [githubToken, setGithubToken] = useState('');
            const [orgName, setOrgName] = useState('');
            const [repos, setRepos] = useState([]);
            const [scanResults, setScanResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [scanning, setScanning] = useState(false);
            const [tokenSaved, setTokenSaved] = useState(false);
            const [alertCount, setAlertCount] = useState(0);

            const saveGitHubToken = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/github/config/save`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ github_token: githubToken }),
                    });

                    if (response.ok) {
                        setTokenSaved(true);
                        alert('Token do GitHub salvo com sucesso!');
                    } else {
                        alert('Erro ao salvar token do GitHub');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Erro ao salvar token');
                }
            };

            const listRepos = async () => {
                if (!orgName) {
                    alert('Por favor, insira o nome da organização');
                    return;
                }

                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/api/github/repos?org=${encodeURIComponent(orgName)}`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setRepos(data);
                    } else {
                        alert('Erro ao listar repositórios. Verifique o token e a organização.');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Erro ao buscar repositórios');
                } finally {
                    setLoading(false);
                }
            };

            const runTruffleHogScan = async () => {
                if (!orgName) {
                    alert('Por favor, insira o nome da organização');
                    return;
                }

                setScanning(true);
                setScanResults([]);
                setAlertCount(0);

                try {
                    const response = await fetch(`${API_URL}/api/github/trufflehog/scan`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            org: orgName,
                            include_issues: true,
                            include_prs: true,
                            verified_only: true
                        }),
                    });

                    if (response.ok) {
                        // Poll for results
                        setTimeout(() => fetchScanResults(), 3000);
                    } else {
                        alert('Erro ao iniciar scan do TruffleHog');
                        setScanning(false);
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Erro ao executar scan');
                    setScanning(false);
                }
            };

            const fetchScanResults = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/github/trufflehog/results?org=${encodeURIComponent(orgName)}`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setScanResults(data);
                        setAlertCount(data.length);
                        setScanning(false);
                    } else {
                        // Still scanning, try again
                        setTimeout(() => fetchScanResults(), 3000);
                    }
                } catch (err) {
                    console.error('Error:', err);
                    setTimeout(() => fetchScanResults(), 3000);
                }
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-brands fa-github"></i> GitHub Secret Scanner (TruffleHog)</h2>
                            {alertCount > 0 && (
                                <span className="header-badge" style={{backgroundColor: '#ef4444'}}>
                                    {alertCount} Secrets Encontrados! 🚨
                                </span>
                            )}
                        </div>
                    </div>

                    <div className="data-card" style={{marginBottom: '20px'}}>
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-key"></i> Configuração do GitHub Token
                            </div>
                        </div>
                        <div style={{padding: '20px'}}>
                            <div style={{marginBottom: '15px'}}>
                                <label style={{display: 'block', marginBottom: '8px', fontWeight: 'bold'}}>
                                    GitHub Personal Access Token:
                                </label>
                                <input
                                    type="password"
                                    className="search-input"
                                    placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                                    value={githubToken}
                                    onChange={(e) => setGithubToken(e.target.value)}
                                    style={{width: '100%', marginBottom: '10px'}}
                                />
                                <button className="btn-action" onClick={saveGitHubToken}>
                                    <i className="fas fa-save"></i> Salvar Token
                                </button>
                                {tokenSaved && <span style={{marginLeft: '10px', color: '#22c55e'}}>✓ Token salvo!</span>}
                            </div>
                        </div>
                    </div>

                    <div className="data-card" style={{marginBottom: '20px'}}>
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-search"></i> Buscar Secrets em Organização
                            </div>
                        </div>
                        <div style={{padding: '20px'}}>
                            <div style={{marginBottom: '15px'}}>
                                <label style={{display: 'block', marginBottom: '8px', fontWeight: 'bold'}}>
                                    Nome da Organização:
                                </label>
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="ex: trufflesecurity"
                                    value={orgName}
                                    onChange={(e) => setOrgName(e.target.value)}
                                    style={{width: '100%', marginBottom: '10px'}}
                                />
                                <div style={{display: 'flex', gap: '10px'}}>
                                    <button className="btn-action" onClick={listRepos} disabled={loading}>
                                        <i className="fas fa-list"></i> {loading ? 'Carregando...' : 'Listar Repositórios'}
                                    </button>
                                    <button
                                        className="btn-action"
                                        onClick={runTruffleHogScan}
                                        disabled={scanning}
                                        style={{backgroundColor: scanning ? '#666' : '#f97316'}}
                                    >
                                        <i className="fas fa-shield-virus"></i> {scanning ? 'Escaneando...' : 'Escanear com TruffleHog'}
                                    </button>
                                </div>
                            </div>
                            {repos.length > 0 && (
                                <div style={{marginTop: '15px'}}>
                                    <p><strong>Repositórios encontrados:</strong> {repos.length}</p>
                                    <ul style={{maxHeight: '200px', overflow: 'auto', paddingLeft: '20px'}}>
                                        {repos.map((repo, idx) => (
                                            <li key={idx}>{repo}</li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </div>
                    </div>

                    {scanResults.length > 0 && (
                        <div className="data-card">
                            <div className="data-card-header">
                                <div className="data-card-title">
                                    <i className="fas fa-exclamation-triangle"></i> Secrets Detectados
                                    <span className="data-card-count" style={{backgroundColor: '#ef4444'}}>
                                        {scanResults.length}
                                    </span>
                                </div>
                            </div>
                            <div className="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><i className="fas fa-hashtag"></i> #</th>
                                            <th><i className="fas fa-book"></i> Repositório</th>
                                            <th><i className="fas fa-file"></i> Arquivo</th>
                                            <th><i className="fas fa-key"></i> Tipo de Secret</th>
                                            <th><i className="fas fa-exclamation"></i> Detalhes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {scanResults.map((result, index) => (
                                            <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td>{result.repository || 'N/A'}</td>
                                                <td><span className="url-cell">{result.file || 'N/A'}</span></td>
                                                <td>
                                                    <span className="severity-badge severity-critical">
                                                        {result.type || 'Secret'}
                                                    </span>
                                                </td>
                                                <td><span style={{fontSize: '12px'}}>{result.details || 'Verificar repositório'}</span></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                    {scanning && (
                        <div style={{textAlign: 'center', padding: '40px'}}>
                            <div className="loading-spinner"></div>
                            <div className="loading-text">Escaneando repositórios com TruffleHog...</div>
                            <p style={{marginTop: '10px', color: '#888'}}>
                                Este processo pode levar alguns minutos dependendo do tamanho da organização.
                            </p>
                        </div>
                    )}
                </>
            );
        }

        // Settings Tab Component
        function SettingsTab({ token }) {
            const [webhookUrl, setWebhookUrl] = useState('');
            const [webhookSaved, setWebhookSaved] = useState(false);
            const [currentWebhook, setCurrentWebhook] = useState('');
            const [testingWebhook, setTestingWebhook] = useState(false);

            useEffect(() => {
                fetchCurrentWebhook();
            }, []);

            const fetchCurrentWebhook = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/webhook/get`, {
                        headers: { 'Authorization': `Bearer ${token}` },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.webhook_url) {
                            setCurrentWebhook(data.webhook_url);
                            setWebhookUrl(data.webhook_url);
                        }
                    }
                } catch (err) {
                    console.error('Error fetching webhook:', err);
                }
            };

            const saveWebhook = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/webhook/save`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ webhook_url: webhookUrl }),
                    });

                    if (response.ok) {
                        setWebhookSaved(true);
                        setCurrentWebhook(webhookUrl);
                        alert('Webhook do Discord salvo com sucesso!');
                        setTimeout(() => setWebhookSaved(false), 3000);
                    } else {
                        alert('Erro ao salvar webhook');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Erro ao salvar webhook');
                }
            };

            const testWebhook = async () => {
                if (!webhookUrl) {
                    alert('Por favor, configure o webhook primeiro');
                    return;
                }

                setTestingWebhook(true);
                try {
                    // Simulate sending a test notification
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            embeds: [{
                                title: '🧪 Teste de Webhook - EnumRust',
                                description: 'Este é um teste do sistema de notificações do EnumRust.',
                                color: 3447003,
                                fields: [
                                    {
                                        name: 'Status',
                                        value: '✅ Webhook configurado corretamente!',
                                        inline: false
                                    },
                                    {
                                        name: 'Sistema',
                                        value: 'EnumRust Security Dashboard',
                                        inline: true
                                    }
                                ],
                                timestamp: new Date().toISOString(),
                                footer: {
                                    text: 'EnumRust Security Platform'
                                }
                            }]
                        }),
                    });

                    if (response.ok) {
                        alert('✅ Webhook testado com sucesso! Verifique seu canal do Discord.');
                    } else {
                        alert('❌ Erro ao testar webhook. Verifique a URL.');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('❌ Erro ao testar webhook: ' + err.message);
                } finally {
                    setTestingWebhook(false);
                }
            };

            return (
                <>
                    <div className="content-header">
                        <div className="header-title">
                            <h2><i className="fas fa-cog"></i> Configurações do Sistema</h2>
                        </div>
                    </div>

                    <div className="data-card" style={{marginBottom: '20px'}}>
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-brands fa-discord"></i> Webhook do Discord
                            </div>
                        </div>
                        <div style={{padding: '20px'}}>
                            <div style={{marginBottom: '20px', padding: '15px', backgroundColor: 'rgba(59, 130, 246, 0.1)', borderRadius: '8px', border: '1px solid rgba(59, 130, 246, 0.3)'}}>
                                <p style={{margin: '0 0 10px 0', fontWeight: 'bold', color: '#3b82f6'}}>
                                    <i className="fas fa-info-circle"></i> Sobre as Notificações
                                </p>
                                <p style={{margin: '0', fontSize: '14px', lineHeight: '1.6'}}>
                                    Configure um webhook do Discord para receber alertas automáticos quando:
                                </p>
                                <ul style={{marginTop: '10px', paddingLeft: '20px', fontSize: '14px'}}>
                                    <li>Vulnerabilidades forem encontradas pelo Nuclei</li>
                                    <li>Secrets forem detectados em código</li>
                                    <li>Novos subdomínios forem descobertos</li>
                                    <li>Falhas críticas forem identificadas</li>
                                </ul>
                            </div>

                            {currentWebhook && (
                                <div style={{marginBottom: '15px', padding: '10px', backgroundColor: 'rgba(34, 197, 94, 0.1)', borderRadius: '8px'}}>
                                    <p style={{margin: '0', color: '#22c55e', fontSize: '14px'}}>
                                        <i className="fas fa-check-circle"></i> Webhook configurado e ativo
                                    </p>
                                </div>
                            )}

                            <div style={{marginBottom: '15px'}}>
                                <label style={{display: 'block', marginBottom: '8px', fontWeight: 'bold'}}>
                                    URL do Webhook:
                                </label>
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="https://discord.com/api/webhooks/..."
                                    value={webhookUrl}
                                    onChange={(e) => setWebhookUrl(e.target.value)}
                                    style={{width: '100%', marginBottom: '10px'}}
                                />
                                <div style={{display: 'flex', gap: '10px'}}>
                                    <button className="btn-action" onClick={saveWebhook}>
                                        <i className="fas fa-save"></i> Salvar Webhook
                                    </button>
                                    <button
                                        className="btn-action"
                                        onClick={testWebhook}
                                        disabled={testingWebhook || !webhookUrl}
                                        style={{backgroundColor: '#5865f2'}}
                                    >
                                        <i className="fas fa-paper-plane"></i> {testingWebhook ? 'Enviando...' : 'Testar Webhook'}
                                    </button>
                                </div>
                                {webhookSaved && (
                                    <span style={{marginTop: '10px', display: 'block', color: '#22c55e'}}>
                                        ✓ Webhook salvo com sucesso!
                                    </span>
                                )}
                            </div>

                            <div style={{marginTop: '20px', padding: '15px', backgroundColor: 'rgba(234, 179, 8, 0.1)', borderRadius: '8px', border: '1px solid rgba(234, 179, 8, 0.3)'}}>
                                <p style={{margin: '0 0 10px 0', fontWeight: 'bold', color: '#eab308'}}>
                                    <i className="fas fa-lightbulb"></i> Como obter a URL do Webhook:
                                </p>
                                <ol style={{margin: '0', paddingLeft: '20px', fontSize: '14px', lineHeight: '1.8'}}>
                                    <li>Acesse as configurações do seu servidor Discord</li>
                                    <li>Vá em "Integrações" → "Webhooks"</li>
                                    <li>Clique em "Novo Webhook"</li>
                                    <li>Configure o nome e canal</li>
                                    <li>Copie a URL do webhook</li>
                                    <li>Cole aqui e clique em "Salvar Webhook"</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <div className="data-card">
                        <div className="data-card-header">
                            <div className="data-card-title">
                                <i className="fas fa-bell"></i> Tipos de Alertas
                            </div>
                        </div>
                        <div style={{padding: '20px'}}>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '15px'}}>
                                <div style={{padding: '15px', backgroundColor: 'rgba(239, 68, 68, 0.1)', borderRadius: '8px', border: '1px solid rgba(239, 68, 68, 0.3)'}}>
                                    <h4 style={{margin: '0 0 8px 0', color: '#ef4444'}}>
                                        <i className="fas fa-bug"></i> Vulnerabilidades Críticas
                                    </h4>
                                    <p style={{margin: '0', fontSize: '13px'}}>Alertas para vulnerabilidades críticas e altas detectadas pelo Nuclei</p>
                                </div>
                                <div style={{padding: '15px', backgroundColor: 'rgba(249, 115, 22, 0.1)', borderRadius: '8px', border: '1px solid rgba(249, 115, 22, 0.3)'}}>
                                    <h4 style={{margin: '0 0 8px 0', color: '#f97316'}}>
                                        <i className="fas fa-key"></i> Secrets Detectados
                                    </h4>
                                    <p style={{margin: '0', fontSize: '13px'}}>Notificações quando tokens ou senhas forem encontrados</p>
                                </div>
                                <div style={{padding: '15px', backgroundColor: 'rgba(59, 130, 246, 0.1)', borderRadius: '8px', border: '1px solid rgba(59, 130, 246, 0.3)'}}>
                                    <h4 style={{margin: '0 0 8px 0', color: '#3b82f6'}}>
                                        <i className="fas fa-sitemap"></i> Novos Subdomínios
                                    </h4>
                                    <p style={{margin: '0', fontSize: '13px'}}>Alertas quando novos subdomínios forem descobertos</p>
                                </div>
                                <div style={{padding: '15px', backgroundColor: 'rgba(168, 85, 247, 0.1)', borderRadius: '8px', border: '1px solid rgba(168, 85, 247, 0.3)'}}>
                                    <h4 style={{margin: '0 0 8px 0', color: '#a855f7'}}>
                                        <i className="fas fa-shield-alt"></i> Atualizações de Status
                                    </h4>
                                    <p style={{margin: '0', fontSize: '13px'}}>Notificações sobre progresso e conclusão de scans</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
